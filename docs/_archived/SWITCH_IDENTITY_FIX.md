# 🔧 社区工作者身份切换问题 - 修复总结

## ❌ 问题描述
用户无法在"切换身份"页面选择"社区工作者"身份。

## 🔍 问题原因
`pages/switch-identity/` 页面中还在检查 `government` 类型，没有更新为 `communityWorker`。

## ✅ 已修复的文件

### 1. `pages/switch-identity/index.js`
- ✅ 将 `government` 改为 `communityWorker`
- ✅ 更新提示文案："政府/监管部门" → "社区工作者"
- ✅ 更新认证字段：`department` → `community`

### 2. `pages/switch-identity/index.wxml`
- ✅ 将 `government` 改为 `communityWorker`
- ✅ 更新提示信息
- ✅ 更新表单字段判断

## 🎯 社区工作者切换逻辑

### 方式1：通过"切换身份"页面（不推荐）
- 用户点击"社区工作者"
- 系统提示：需要认证，请联系管理员
- **无法直接切换**（因为需要认证）

### 方式2：通过登录页面申请认证（推荐）✅
1. 退出登录
2. 重新登录
3. 选择"社区工作者"身份
4. 填写认证信息（所属社区、职位、工作证号）
5. 提交申请
6. 等待管理员审核
7. 审核通过后自动变为社区工作者

### 方式3：管理员直接审核（最快）✅
1. 用户提交社区工作者认证申请
2. 管理员进入"认证审核"页面
3. 审核通过
4. 用户身份自动变为社区工作者

## 📋 完整的操作流程

### 对于普通用户想成为社区工作者：

#### 步骤1：提交认证申请
1. 退出登录
2. 点击"登录"
3. 选择"社区工作者"身份
4. 填写信息：
   - 头像、昵称、手机号
   - 所属社区（如：XX社区居委会）
   - 职位（如：社区主任、网格员）
   - 工作证号
5. 点击"完成"
6. 系统提示："认证申请已提交，请等待管理员审核"

#### 步骤2：管理员审核
1. 管理员登录
2. 进入"我的"页面
3. 点击"🔐 认证审核"
4. 查看待审核申请
5. 点击"✅ 通过"或"❌ 拒绝"

#### 步骤3：审核通过
- 用户身份自动变为"社区工作者"
- 显示红色徽章：🔴 社区工作者
- 个人主页显示认证信息

## 🚫 为什么不能直接切换？

社区工作者是**需要认证的身份**，不能像普通用户、设计者、施工方那样随意切换。

原因：
1. 需要验证真实身份
2. 需要填写认证信息（所属社区、职位、工作证号）
3. 需要管理员审核确认
4. 防止身份冒用

## 📝 需要上传的云函数

确保以下云函数已上传：
1. ✅ `updateUserInfo` - 更新用户信息
2. ✅ `applyCommunityWorkerCertification` - 提交认证申请
3. ✅ `getCommunityWorkerCertApplications` - 获取申请列表
4. ✅ `getCommunityWorkerCertStats` - 获取统计数据
5. ✅ `reviewCommunityWorkerCertification` - 审核申请
6. ✅ `removeCommunityWorkerCertification` - 移除身份
7. ⚙️ `fixCommunityWorkerBadge` - 修复徽章（可选）

## 🎉 修复完成

现在：
- ✅ 切换身份页面会正确识别社区工作者
- ✅ 点击社区工作者会提示需要认证
- ✅ 用户需要通过登录页面申请认证
- ✅ 管理员可以审核认证申请
- ✅ 审核通过后自动变为社区工作者

---

**修复时间**：2026-02-01
**问题**：无法切换成社区工作者
**原因**：代码中还在检查 government 类型
**解决**：更新为 communityWorker 类型

