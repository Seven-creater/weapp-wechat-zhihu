# 登录/退出登录功能测试指南

## 快速测试步骤

### 1. 首次登录测试

1. 打开小程序，点击底部"我的"标签
2. 应该看到"点击登录"的紫色渐变卡片
3. 点击卡片，跳转到登录页面
4. 点击头像，选择一张照片
5. 点击昵称输入框，输入昵称（例如："测试用户"）
6. 点击"完成"按钮
7. 等待上传和保存（会显示进度提示）
8. 成功后自动返回"我的"页面
9. 验证：
   - ✅ 显示刚才选择的头像
   - ✅ 显示刚才输入的昵称
   - ✅ 显示"退出登录"按钮
   - ✅ 显示统计数据（关注、粉丝、获赞）
   - ✅ 显示内容标签页（笔记、收藏、赞过）

### 2. 编辑资料测试

1. 在"我的"页面，点击头像
2. 跳转到"编辑资料"页面
3. 点击头像，选择新照片
4. 修改昵称
5. 点击右上角"保存"按钮
6. 成功后自动返回"我的"页面
7. 验证：
   - ✅ 头像已更新
   - ✅ 昵称已更新

### 3. 退出登录测试

1. 在"我的"页面，点击"退出登录"按钮
2. 弹出确认对话框
3. 点击"退出"
4. 验证：
   - ✅ 显示"点击登录"卡片
   - ✅ 统计数据消失
   - ✅ 内容标签页消失
   - ✅ 内容列表消失

### 4. 重新登录测试

1. 点击"点击登录"卡片
2. 跳转到登录页面
3. 验证：
   - ✅ 自动填充之前的头像
   - ✅ 自动填充之前的昵称
4. 可以直接点击"完成"，或修改后再点击
5. 登录成功后返回"我的"页面
6. 验证：
   - ✅ 恢复登录状态
   - ✅ 显示用户信息

### 5. 数据持久化测试

1. 登录成功后，关闭小程序
2. 重新打开小程序
3. 点击"我的"标签
4. 验证：
   - ✅ 仍然是登录状态
   - ✅ 用户信息正确显示

## 预期结果

### 未登录状态
```
┌─────────────────────────────┐
│  [头像]  点击登录            │
│         登录后查看更多内容    │
└─────────────────────────────┘
```

### 已登录状态
```
┌─────────────────────────────┐
│  [头像]  用户昵称  [退出登录] │
│         無界营造号：123456789 │
├─────────────────────────────┤
│   关注    粉丝    获赞与收藏  │
│    0      0         0       │
├─────────────────────────────┤
│  笔记  |  收藏  |  赞过      │
├─────────────────────────────┤
│  [内容列表...]              │
└─────────────────────────────┘
```

## 常见问题排查

### 问题1：点击"完成"后没有反应
**可能原因：**
- 云函数未部署
- 网络连接问题
- 云开发环境未初始化

**解决方法：**
1. 检查控制台错误信息
2. 确认云函数已上传并部署
3. 检查 `config/index.js` 中的云环境 ID

### 问题2：头像上传失败
**可能原因：**
- 云存储权限问题
- 文件过大

**解决方法：**
1. 检查云存储权限设置
2. 压缩图片后重试

### 问题3：退出登录后数据没有清空
**可能原因：**
- 代码逻辑问题

**解决方法：**
1. 检查 `handleLogout` 方法
2. 确认 `setData` 正确执行

## 开发者工具调试

### 查看 Storage
1. 打开调试器
2. 点击 Storage 标签
3. 查看：
   - `openid`: 应该有值（已登录）或为空（未登录）
   - `userInfo`: 应该有 `{ nickName, avatarUrl }`

### 查看云数据库
1. 打开云开发控制台
2. 进入数据库
3. 查看 `users` 集合
4. 应该能看到用户记录

### 查看云函数日志
1. 打开云开发控制台
2. 进入云函数
3. 查看 `login` 和 `updateUserInfo` 的调用日志

## 测试检查清单

- [ ] 首次登录成功
- [ ] 头像上传成功
- [ ] 昵称保存成功
- [ ] 编辑资料成功
- [ ] 退出登录成功
- [ ] 页面清空正确
- [ ] 重新登录成功
- [ ] 数据恢复正确
- [ ] 关闭重开后状态保持
- [ ] 云数据库记录正确

## 性能指标

- 登录耗时：< 3秒
- 头像上传：< 5秒
- 退出登录：< 1秒
- 页面切换：< 500ms

---

**测试完成后，请在此记录：**

- 测试日期：__________
- 测试人员：__________
- 测试结果：□ 通过  □ 失败
- 问题记录：__________








