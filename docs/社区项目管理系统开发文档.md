# ğŸš€ ç¤¾åŒºé¡¹ç›®ç®¡ç†ç³»ç»Ÿå¼€å‘æ–‡æ¡£

## ğŸ“‹ å·²å®Œæˆçš„äº‘å‡½æ•°ï¼ˆ8ä¸ªï¼‰

### âœ… å·²åˆ›å»ºçš„äº‘å‡½æ•°
1. **createDailyPost** - åˆ›å»ºæ—¥å¸¸å¸–å­
2. **createDesignProposal** - åˆ›å»ºè®¾è®¡æ–¹æ¡ˆ
3. **createProject** - åˆ›å»ºæ–½å·¥é¡¹ç›®
4. **updateProjectNode** - æ›´æ–°é¡¹ç›®èŠ‚ç‚¹
5. **confirmProjectCompletion** - ç¡®è®¤é¡¹ç›®å®Œæˆ
6. **moveToCase** - ç§»å…¥æ¡ˆä¾‹æ¿å—
7. **getCases** - è·å–æ¡ˆä¾‹åˆ—è¡¨
8. **getUserPhone** - è·å–ç”¨æˆ·æ‰‹æœºå·ï¼ˆç¤¾åŒºå·¥ä½œè€…ä¸“ç”¨ï¼‰

---

## ğŸ“± éœ€è¦åˆ›å»ºçš„é¡µé¢æ¸…å•

### âœ… å·²å®Œæˆ
1. **pages/post/daily** - æ—¥å¸¸å¸–å­å‘å¸ƒé¡µï¼ˆå·²å®Œæˆï¼‰
2. **pages/design/proposal** - è®¾è®¡æ–¹æ¡ˆé¡µï¼ˆJSå·²å®Œæˆï¼‰

### ğŸ”¨ å¾…å®Œæˆé¡µé¢

#### 3. **pages/project/create** - é¡¹ç›®åˆ›å»ºé¡µ
**åŠŸèƒ½**ï¼šæ–½å·¥æ–¹é€‰æ‹©éšœç¢é—®é¢˜ï¼Œåˆ›å»ºæ–½å·¥é¡¹ç›®
**æ ¸å¿ƒä»£ç **ï¼š
```javascript
// å…³é”®åŠŸèƒ½
- æ˜¾ç¤ºéšœç¢é—®é¢˜è¯¦æƒ…
- è¾“å…¥é¡¹ç›®åç§°
- è¾“å…¥è”ç³»ç”µè¯
- è°ƒç”¨ createProject äº‘å‡½æ•°
```

#### 4. **pages/project/manage** - é¡¹ç›®ç®¡ç†é¡µ
**åŠŸèƒ½**ï¼šæ–½å·¥æ–¹æŸ¥çœ‹å’Œç®¡ç†è‡ªå·±çš„é¡¹ç›®åˆ—è¡¨
**æ ¸å¿ƒä»£ç **ï¼š
```javascript
// æŸ¥è¯¢è‡ªå·±çš„é¡¹ç›®
db.collection('projects')
  .where({ _openid: openid })
  .orderBy('createTime', 'desc')
  .get()
```

#### 5. **pages/project/detail** - é¡¹ç›®è¯¦æƒ…é¡µ
**åŠŸèƒ½**ï¼šæ˜¾ç¤ºé¡¹ç›®è¯¦æƒ…ï¼Œä¸‰ä¸ªèŠ‚ç‚¹è¿›åº¦ï¼Œå®Œæˆç¡®è®¤æŒ‰é’®
**æ ¸å¿ƒä»£ç **ï¼š
```javascript
// æ˜¾ç¤ºä¸‰ä¸ªèŠ‚ç‚¹çŠ¶æ€
nodes.map(node => {
  return {
    name: node.name,
    status: node.status, // pending/completed
    images: node.images,
    description: node.description
  }
})

// ç¡®è®¤å®ŒæˆæŒ‰é’®ï¼ˆå‘å¸–è€…æˆ–ç¤¾åŒºå·¥ä½œè€…ï¼‰
confirmCompletion() {
  wx.cloud.callFunction({
    name: 'confirmProjectCompletion',
    data: {
      projectId: this.data.projectId,
      confirmedBy: 'poster' // æˆ– 'worker'
    }
  })
}
```

#### 6. **pages/project/update** - æ–½å·¥è¿›åº¦æ›´æ–°é¡µ
**åŠŸèƒ½**ï¼šæ–½å·¥æ–¹æ›´æ–°èŠ‚ç‚¹è¿›åº¦ï¼ˆå‡†å¤‡/æ–½å·¥/éªŒæ”¶ï¼‰
**æ ¸å¿ƒä»£ç **ï¼š
```javascript
// ä¸Šä¼ èŠ‚ç‚¹ç…§ç‰‡å’Œæè¿°
updateNode() {
  // 1. ä¸Šä¼ ç…§ç‰‡åˆ°äº‘å­˜å‚¨
  // 2. è°ƒç”¨ updateProjectNode äº‘å‡½æ•°
  wx.cloud.callFunction({
    name: 'updateProjectNode',
    data: {
      projectId: this.data.projectId,
      nodeIndex: this.data.nodeIndex, // 0/1/2
      images: fileIDs,
      description: this.data.description,
      actualCost: this.data.actualCost // å®é™…æ¶ˆè€—èµ„é‡‘
    }
  })
}
```

#### 7. **pages/cases/index** - æ¡ˆä¾‹æ¿å—é¡µ
**åŠŸèƒ½**ï¼šå±•ç¤ºå·²å®Œæˆçš„æ¡ˆä¾‹ï¼ŒæŒ‰äº”å¤§å·¥ç¨‹åˆ†ç±»
**æ ¸å¿ƒä»£ç **ï¼š
```javascript
// äº”å¤§å·¥ç¨‹åˆ†ç±»
categories: [
  'æ— éšœç¢åœè½¦ä½',
  'æ— éšœç¢å«ç”Ÿé—´',
  'æ— éšœç¢å¡é“',
  'æ— éšœç¢ç”µæ¢¯',
  'æ— éšœç¢å‡é™å°'
]

// åŠ è½½æ¡ˆä¾‹
loadCases(category) {
  wx.cloud.callFunction({
    name: 'getCases',
    data: {
      category: category,
      page: this.data.page,
      pageSize: 10
    }
  })
}
```

#### 8. **pages/cases/detail** - æ¡ˆä¾‹è¯¦æƒ…é¡µ
**åŠŸèƒ½**ï¼šå®Œæ•´å±•ç¤ºæ¡ˆä¾‹ï¼ˆé—®é¢˜â†’è®¾è®¡â†’æ–½å·¥â†’å®Œæˆï¼‰
**æ ¸å¿ƒä»£ç **ï¼š
```javascript
// æ˜¾ç¤ºç»“æ„
{
  problem: { /* é—®é¢˜æè¿°å’Œç…§ç‰‡ */ },
  designProposal: { /* è®¾è®¡æ–¹æ¡ˆï¼ˆå¦‚æœæœ‰ï¼‰*/ },
  construction: {
    nodes: [
      { name: 'å‡†å¤‡', images: [], description: '' },
      { name: 'æ–½å·¥', images: [], description: '' },
      { name: 'éªŒæ”¶', images: [], description: '' }
    ]
  },
  budget: {
    estimated: 0,  // AIä¼°ç®—
    adjusted: 0,   // è®¾è®¡è€…è°ƒæ•´
    final: 0       // å®é™…æ¶ˆè€—
  }
}
```

---

## ğŸ”„ éœ€è¦ä¿®æ”¹çš„ç°æœ‰é¡µé¢

### 1. **pages/community/community** - ç¤¾åŒºé¡µé¢
**ä¿®æ”¹å†…å®¹**ï¼š
- åŒºåˆ†æ˜¾ç¤ºä¸¤ç§å¸–å­ï¼ˆéšœç¢é—®é¢˜ + æ—¥å¸¸å¸–å­ï¼‰
- æ·»åŠ ç­›é€‰æ ‡ç­¾
- æ˜¾ç¤ºå¸–å­çŠ¶æ€ï¼ˆå¾…å¤„ç†/å¤„ç†ä¸­/å·²å¤„ç†ï¼‰

**å…³é”®ä»£ç **ï¼š
```javascript
// æŸ¥è¯¢æ—¶åŒºåˆ†ç±»å‹
db.collection('posts')
  .where({
    type: db.command.in(['issue', 'daily'])
  })
  .orderBy('createTime', 'desc')
  .get()

// æ˜¾ç¤ºçŠ¶æ€æ ‡è¯†
<view class="status-badge {{item.status}}">
  {{item.status === 'pending' ? 'å¾…å¤„ç†' : 
    item.status === 'processing' ? 'å¤„ç†ä¸­' : 'å·²å¤„ç†'}}
</view>
```

### 2. **pages/post-detail/index** - å¸–å­è¯¦æƒ…é¡µ
**ä¿®æ”¹å†…å®¹**ï¼š
- æ ¹æ®å¸–å­ç±»å‹æ˜¾ç¤ºä¸åŒå†…å®¹
- éšœç¢é—®é¢˜ï¼šæ˜¾ç¤ºçŠ¶æ€ã€å…³è”é¡¹ç›®ã€è®¾è®¡æ–¹æ¡ˆåˆ—è¡¨
- æ—¥å¸¸å¸–å­ï¼šæ­£å¸¸æ˜¾ç¤º
- æ·»åŠ "æ·»åŠ è®¾è®¡æ–¹æ¡ˆ"æŒ‰é’®ï¼ˆè®¾è®¡è€…ï¼‰
- æ·»åŠ "åˆ›å»ºé¡¹ç›®"æŒ‰é’®ï¼ˆæ–½å·¥æ–¹ï¼‰

**å…³é”®ä»£ç **ï¼š
```javascript
// åŠ è½½è®¾è®¡æ–¹æ¡ˆåˆ—è¡¨
loadDesignProposals() {
  db.collection('design_proposals')
    .where({ postId: this.data.postId })
    .orderBy('createTime', 'desc')
    .get()
}

// åŠ è½½å…³è”é¡¹ç›®
loadProject() {
  if (this.data.post.projectId) {
    db.collection('projects')
      .doc(this.data.post.projectId)
      .get()
  }
}
```

### 3. **pages/mine/index** - ä¸ªäººä¸­å¿ƒ
**ä¿®æ”¹å†…å®¹**ï¼š
- è®¾è®¡è€…ï¼šæ·»åŠ "æˆ‘çš„è®¾è®¡æ–¹æ¡ˆ"å…¥å£
- æ–½å·¥æ–¹ï¼šæ·»åŠ "æˆ‘çš„é¡¹ç›®"å…¥å£
- ç¤¾åŒºå·¥ä½œè€…ï¼šæ·»åŠ "ç›‘ç£ç®¡ç†"å…¥å£

**å…³é”®ä»£ç **ï¼š
```javascript
// æ ¹æ®ç”¨æˆ·ç±»å‹æ˜¾ç¤ºä¸åŒå…¥å£
<view wx:if="{{userType === 'designer'}}" class="menu-item" bindtap="goToMyProposals">
  <text>æˆ‘çš„è®¾è®¡æ–¹æ¡ˆ</text>
</view>

<view wx:if="{{userType === 'contractor'}}" class="menu-item" bindtap="goToMyProjects">
  <text>æˆ‘çš„é¡¹ç›®</text>
</view>

<view wx:if="{{userType === 'communityWorker'}}" class="menu-item" bindtap="goToSupervision">
  <text>ç›‘ç£ç®¡ç†</text>
</view>
```

---

## ğŸ¨ UIè®¾è®¡å»ºè®®

### çŠ¶æ€é¢œè‰²
```css
/* å¾…å¤„ç† */
.status-pending {
  background: #fef3c7;
  color: #92400e;
}

/* å¤„ç†ä¸­ */
.status-processing {
  background: #dbeafe;
  color: #1e40af;
}

/* å·²å¤„ç† */
.status-completed {
  background: #d1fae5;
  color: #065f46;
}
```

### èŠ‚ç‚¹è¿›åº¦æ¡
```css
.node-timeline {
  display: flex;
  align-items: center;
}

.node-item {
  flex: 1;
  text-align: center;
}

.node-dot {
  width: 40rpx;
  height: 40rpx;
  border-radius: 50%;
  background: #e5e7eb;
}

.node-dot.completed {
  background: #10b981;
}

.node-line {
  flex: 1;
  height: 4rpx;
  background: #e5e7eb;
}

.node-line.completed {
  background: #10b981;
}
```

---

## ğŸ“Š æ•°æ®æµç¨‹å›¾

### å®Œæ•´ä¸šåŠ¡æµç¨‹
```
1. æ®‹ç–¾äººå‘å¸ƒéšœç¢é—®é¢˜
   â†“
   posts (type=issue, status=pending)
   issues (åŒæ­¥)
   â†“
2. è®¾è®¡è€…æ·»åŠ è®¾è®¡æ–¹æ¡ˆ
   â†“
   design_proposals
   posts.designProposalCount++
   â†“
3. æ–½å·¥æ–¹åˆ›å»ºé¡¹ç›®
   â†“
   projects
   posts.status â†’ processing
   issues.status â†’ processing
   â†“
4. æ–½å·¥æ–¹æ›´æ–°èŠ‚ç‚¹ï¼ˆå‡†å¤‡â†’æ–½å·¥â†’éªŒæ”¶ï¼‰
   â†“
   projects.nodes[0-2] æ›´æ–°
   projects.actualCost ç´¯åŠ 
   â†“
5. å‘å¸–è€… OR ç¤¾åŒºå·¥ä½œè€…ç¡®è®¤å®Œæˆ
   â†“
   projects.completion æ›´æ–°
   â†“
6. è‡ªåŠ¨ç§»å…¥æ¡ˆä¾‹æ¿å—
   â†“
   cases é›†åˆ
   posts.status â†’ completed
   issues.status â†’ completed
   â†“
7. è‡ªåŠ¨è®¡ç®—ç²¾é€‰è¯„åˆ†
   â†“
   cases.featured = true/false
```

---

## ğŸ”§ å¿«é€Ÿå¼€å‘æ¨¡æ¿

### é¡µé¢æ¨¡æ¿ç»“æ„
```javascript
// pages/xxx/index.js
Page({
  data: {
    // æ•°æ®
  },
  
  onLoad(options) {
    // åˆå§‹åŒ–
  },
  
  // åŠ è½½æ•°æ®
  loadData() {
    wx.showLoading({ title: 'åŠ è½½ä¸­...' });
    wx.cloud.callFunction({
      name: 'xxx',
      data: {}
    }).then(res => {
      wx.hideLoading();
      if (res.result && res.result.success) {
        this.setData({ data: res.result.data });
      }
    }).catch(err => {
      wx.hideLoading();
      wx.showToast({ title: 'åŠ è½½å¤±è´¥', icon: 'none' });
    });
  },
  
  // æäº¤æ•°æ®
  submitData() {
    if (this.data.submitting) return;
    this.setData({ submitting: true });
    
    wx.showLoading({ title: 'æäº¤ä¸­...' });
    wx.cloud.callFunction({
      name: 'xxx',
      data: {}
    }).then(res => {
      wx.hideLoading();
      this.setData({ submitting: false });
      
      if (res.result && res.result.success) {
        wx.showToast({ title: 'æˆåŠŸ', icon: 'success' });
        setTimeout(() => wx.navigateBack(), 1500);
      } else {
        throw new Error(res.result?.error || 'å¤±è´¥');
      }
    }).catch(err => {
      wx.hideLoading();
      this.setData({ submitting: false });
      wx.showToast({ title: err.message, icon: 'none' });
    });
  }
});
```

---

## âœ… å¼€å‘æ£€æŸ¥æ¸…å•

### äº‘å‡½æ•°éƒ¨ç½²
- [ ] createDailyPost
- [ ] createDesignProposal
- [ ] createProject
- [ ] updateProjectNode
- [ ] confirmProjectCompletion
- [ ] moveToCase
- [ ] getCases
- [ ] getUserPhone

### é¡µé¢åˆ›å»º
- [x] pages/post/daily
- [x] pages/design/proposal (JS)
- [ ] pages/design/proposal (WXML/WXSS)
- [ ] pages/project/create
- [ ] pages/project/manage
- [ ] pages/project/detail
- [ ] pages/project/update
- [ ] pages/cases/index
- [ ] pages/cases/detail

### é¡µé¢ä¿®æ”¹
- [ ] pages/community/community
- [ ] pages/post-detail/index
- [ ] pages/mine/index

### æ•°æ®åº“é›†åˆ
- [ ] posts (æ‰©å±•typeå­—æ®µ)
- [ ] design_proposals (æ–°å»º)
- [ ] projects (æ–°å»º)
- [ ] cases (æ–°å»º)

---

## ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **éƒ¨ç½²äº‘å‡½æ•°**ï¼ˆçº¦10åˆ†é’Ÿï¼‰
2. **å®Œæˆå‰©ä½™é¡µé¢**ï¼ˆçº¦2-3å°æ—¶ï¼‰
3. **ä¿®æ”¹ç°æœ‰é¡µé¢**ï¼ˆçº¦1å°æ—¶ï¼‰
4. **æµ‹è¯•åŠŸèƒ½**ï¼ˆçº¦1å°æ—¶ï¼‰

**é¢„è®¡æ€»æ—¶é—´ï¼š4-5å°æ—¶å®Œæˆå…¨éƒ¨åŠŸèƒ½**

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0  
**åˆ›å»ºæ—¶é—´**ï¼š2026-02-02  
**çŠ¶æ€**ï¼šè¿›è¡Œä¸­



