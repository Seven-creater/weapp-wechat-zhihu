# 小红书风格社交系统设计方案

## 目录
1. [系统概述](#系统概述)
2. [核心功能](#核心功能)
3. [数据库设计](#数据库设计)
4. [页面结构](#页面结构)
5. [交互流程](#交互流程)
6. [实现细节](#实现细节)

---

## 系统概述

本方案参考小红书的社交系统，实现以下核心功能：
- 用户关注/取消关注
- 关注列表/粉丝列表
- 私信聊天
- 消息通知
- 用户主页
- 互动提醒

### 设计原则
1. **简洁直观** - 界面清晰，操作简单
2. **实时互动** - 消息实时推送，状态实时更新
3. **社交优先** - 强化用户之间的连接和互动
4. **隐私保护** - 保护用户隐私信息

---

## 核心功能

### 1. 关注系统

#### 1.1 关注/取消关注
- **位置**：用户主页、帖子详情页、关注列表
- **交互**：
  - 未关注：显示"关注"按钮（蓝色）
  - 已关注：显示"已关注"按钮（灰色）
  - 互相关注：显示"互相关注"标识
- **动画**：点击时按钮有缩放动画效果

#### 1.2 关注列表
- 显示我关注的所有用户
- 每个用户显示：头像、昵称、简介、关注状态
- 支持搜索和筛选
- 显示"互相关注"标识

#### 1.3 粉丝列表
- 显示关注我的所有用户
- 每个用户显示：头像、昵称、简介、关注状态
- 支持"回关"操作
- 显示"互相关注"标识

### 2. 私信系统

#### 2.1 消息列表
- 显示所有会话列表
- 每个会话显示：
  - 对方头像、昵称
  - 最后一条消息内容
  - 未读消息数量（红点）
  - 时间（智能显示：刚刚、5分钟前、昨天、日期）
- 支持删除会话
- 支持置顶会话

#### 2.2 聊天页面
- 实时消息推送
- 支持发送文字、图片、表情
- 消息状态：发送中、已发送、已读
- 长按消息：复制、删除、撤回（2分钟内）
- 显示对方输入状态

#### 2.3 消息通知
- 新消息红点提醒
- 消息推送通知
- 消息免打扰设置

### 3. 用户主页

#### 3.1 个人信息区
- 头像（大图）
- 昵称、简介
- 关注数、粉丝数、获赞数
- 关注/私信按钮
- 更多操作（举报、拉黑）

#### 3.2 内容展示
- Tab切换：笔记、收藏、赞过
- 瀑布流布局
- 支持筛选和排序

### 4. 互动通知

#### 4.1 通知类型
- 新粉丝通知
- 点赞通知
- 评论通知
- @我的通知
- 系统通知

#### 4.2 通知展示
- 分类显示
- 未读标识
- 一键已读
- 跳转到相关内容

---

## 数据库设计

### 1. users 集合（用户信息）
```javascript
{
  _id: "记录ID",
  _openid: "用户openid",
  userInfo: {
    nickName: "昵称",
    avatarUrl: "头像URL",
    bio: "个人简介",
    gender: 0, // 0未知 1男 2女
    location: "地区"
  },
  stats: {
    followingCount: 0,  // 关注数
    followersCount: 0,  // 粉丝数
    likesCount: 0,      // 获赞数
    postsCount: 0       // 笔记数
  },
  settings: {
    allowMessage: true,     // 允许私信
    allowNotification: true // 允许通知
  },
  createTime: "创建时间",
  updateTime: "更新时间"
}
```

### 2. follows 集合（关注关系）
```javascript
{
  _id: "记录ID",
  followerId: "关注者openid",
  targetId: "被关注者openid",
  isMutual: false,  // 是否互相关注
  createTime: "关注时间"
}
```

### 3. conversations 集合（会话列表）
```javascript
{
  _id: "记录ID",
  _openid: "当前用户openid",
  targetId: "对方openid",
  targetUserInfo: {
    nickName: "对方昵称",
    avatarUrl: "对方头像"
  },
  lastMessage: {
    content: "最后一条消息",
    type: "text", // text/image/system
    senderId: "发送者openid",
    time: "发送时间"
  },
  unreadCount: 0,    // 未读数量
  isPinned: false,   // 是否置顶
  isMuted: false,    // 是否免打扰
  updateTime: "更新时间"
}
```

### 4. messages 集合（聊天消息）
```javascript
{
  _id: "消息ID",
  _openid: "发送者openid",
  roomId: "聊天室ID（两个openid排序后用_连接）",
  senderId: "发送者openid",
  receiverId: "接收者openid",
  content: "消息内容",
  type: "text", // text/image/system
  imageUrl: "图片URL（如果是图片消息）",
  status: "sent", // sending/sent/read
  isRecalled: false, // 是否已撤回
  createTime: "发送时间"
}
```

### 5. notifications 集合（通知消息）
```javascript
{
  _id: "通知ID",
  _openid: "接收者openid",
  type: "follow", // follow/like/comment/mention/system
  fromUserId: "触发者openid",
  fromUserInfo: {
    nickName: "触发者昵称",
    avatarUrl: "触发者头像"
  },
  content: "通知内容",
  relatedId: "相关内容ID（帖子ID、评论ID等）",
  isRead: false,
  createTime: "创建时间"
}
```

---

## 页面结构

### 1. 消息中心（pages/notify/notify）
```
┌─────────────────────────────┐
│  消息                    [设置] │
├─────────────────────────────┤
│  [私信] [通知] [互动]          │
├─────────────────────────────┤
│  ┌─┐  张三                   │
│  │头│  你好，在吗？      [2]   │
│  └─┘  5分钟前                │
├─────────────────────────────┤
│  ┌─┐  李四                   │
│  │头│  收到，谢谢！            │
│  └─┘  昨天                   │
├─────────────────────────────┤
│  ┌─┐  王五                   │
│  │头│  [图片]          [1]   │
│  └─┘  2天前                  │
└─────────────────────────────┘
```

### 2. 聊天页面（pages/chat/chat）
```
┌─────────────────────────────┐
│  < 张三              [···]   │
├─────────────────────────────┤
│                             │
│  ┌─────────┐               │
│  │你好！    │  [头像]        │
│  └─────────┘  10:30         │
│                             │
│        [头像]  ┌─────────┐  │
│        10:31  │在的，有事吗│  │
│              └─────────┘  │
│                             │
│  ┌─────────┐               │
│  │想问一下...│  [头像]       │
│  └─────────┘  10:32         │
│                             │
├─────────────────────────────┤
│  [+] [输入框...]      [发送]  │
└─────────────────────────────┘
```

### 3. 用户主页（pages/user-profile/index）
```
┌─────────────────────────────┐
│  < 用户主页          [···]   │
├─────────────────────────────┤
│      ┌───────┐              │
│      │       │              │
│      │ 头像  │              │
│      │       │              │
│      └───────┘              │
│                             │
│        张三                  │
│    这是我的个人简介           │
│                             │
│   关注    粉丝    获赞        │
│   123     456     789       │
│                             │
│  [关注]  [私信]  [···]       │
├─────────────────────────────┤
│  [笔记] [收藏] [赞过]         │
├─────────────────────────────┤
│  ┌────┐ ┌────┐ ┌────┐      │
│  │图片│ │图片│ │图片│      │
│  │标题│ │标题│ │标题│      │
│  └────┘ └────┘ └────┘      │
└─────────────────────────────┘
```

### 4. 关注/粉丝列表（pages/follow-list/index）
```
┌─────────────────────────────┐
│  < 关注                      │
├─────────────────────────────┤
│  [搜索框]                    │
├─────────────────────────────┤
│  ┌─┐  张三                   │
│  │头│  这是我的简介            │
│  └─┘  [互相关注]             │
├─────────────────────────────┤
│  ┌─┐  李四                   │
│  │头│  这是我的简介            │
│  └─┘  [已关注]               │
├─────────────────────────────┤
│  ┌─┐  王五                   │
│  │头│  这是我的简介            │
│  └─┘  [关注]                 │
└─────────────────────────────┘
```

---

## 交互流程

### 1. 关注流程
```
用户A查看用户B主页
    ↓
点击"关注"按钮
    ↓
按钮变为"已关注"（灰色）
    ↓
用户B的粉丝数+1
    ↓
用户A的关注数+1
    ↓
用户B收到"新粉丝"通知
    ↓
如果用户B也关注了用户A
    ↓
双方显示"互相关注"标识
```

### 2. 私信流程
```
用户A点击用户B的"私信"按钮
    ↓
进入聊天页面
    ↓
输入消息并发送
    ↓
消息保存到数据库
    ↓
用户B实时收到消息（watch监听）
    ↓
用户B的会话列表显示未读红点
    ↓
用户B打开聊天页面
    ↓
未读消息标记为已读
```

### 3. 通知流程
```
用户A关注/点赞/评论用户B的内容
    ↓
创建通知记录
    ↓
用户B的通知Tab显示红点
    ↓
用户B打开通知列表
    ↓
查看通知详情
    ↓
点击通知跳转到相关内容
    ↓
通知标记为已读
```

---

详细实现请查看：
- [数据库操作](./SOCIAL_SYSTEM_DATABASE.md)
- [页面实现](./SOCIAL_SYSTEM_PAGES.md)
- [云函数](./SOCIAL_SYSTEM_CLOUDFUNCTIONS.md)

