# äº‘å‡½æ•°éƒ¨ç½²æŒ‡å—

## ğŸ“‹ éƒ¨ç½²æ¸…å•

### æ–°å¢äº‘å‡½æ•°ï¼ˆéœ€è¦éƒ¨ç½²ï¼‰

1. âœ… `createFacility` - åˆ›å»ºè®¾æ–½è®°å½•
2. âœ… `updateFacilityStatus` - æ›´æ–°è®¾æ–½çŠ¶æ€
3. âœ… `getFacilities` - è·å–è®¾æ–½åˆ—è¡¨

---

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ï¼ˆæ¨èï¼‰

#### 1. éƒ¨ç½²å•ä¸ªäº‘å‡½æ•°

1. åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­ï¼Œå±•å¼€ `cloudfunctions` ç›®å½•
2. å³é”®ç‚¹å‡»è¦éƒ¨ç½²çš„äº‘å‡½æ•°æ–‡ä»¶å¤¹ï¼ˆå¦‚ `createFacility`ï¼‰
3. é€‰æ‹©"ä¸Šä¼ å¹¶éƒ¨ç½²ï¼šäº‘ç«¯å®‰è£…ä¾èµ–"
4. ç­‰å¾…éƒ¨ç½²å®Œæˆï¼ˆä¼šæ˜¾ç¤º"ä¸Šä¼ æˆåŠŸ"ï¼‰

#### 2. æ‰¹é‡éƒ¨ç½²æ‰€æœ‰äº‘å‡½æ•°

1. å³é”®ç‚¹å‡» `cloudfunctions` ç›®å½•
2. é€‰æ‹©"ä¸Šä¼ å¹¶éƒ¨ç½²ï¼šäº‘ç«¯å®‰è£…ä¾èµ–ï¼ˆå…¨éƒ¨ï¼‰"
3. ç­‰å¾…æ‰€æœ‰äº‘å‡½æ•°éƒ¨ç½²å®Œæˆ

### æ–¹æ³•äºŒï¼šä½¿ç”¨å‘½ä»¤è¡Œ

```bash
# è¿›å…¥äº‘å‡½æ•°ç›®å½•
cd cloudfunctions/createFacility

# å®‰è£…ä¾èµ–
npm install

# éƒ¨ç½²
wx-server-sdk deploy
```

---

## ğŸ—„ï¸ æ•°æ®åº“é…ç½®

### 1. åˆ›å»º facilities é›†åˆ

1. æ‰“å¼€å¾®ä¿¡å¼€å‘è€…å·¥å…·
2. ç‚¹å‡»"äº‘å¼€å‘"æŒ‰é’®
3. è¿›å…¥"æ•°æ®åº“"æ ‡ç­¾
4. ç‚¹å‡»"æ·»åŠ é›†åˆ"
5. è¾“å…¥é›†åˆåç§°ï¼š`facilities`
6. ç‚¹å‡»"ç¡®å®š"

### 2. åˆ›å»ºç´¢å¼•

åœ¨ `facilities` é›†åˆä¸­åˆ›å»ºä»¥ä¸‹ç´¢å¼•ï¼š

#### ç´¢å¼•1ï¼šåœ°ç†ä½ç½®ç´¢å¼•ï¼ˆé‡è¦ï¼ï¼‰

```json
{
  "location": "2dsphere"
}
```

**åˆ›å»ºæ­¥éª¤ï¼š**
1. è¿›å…¥ `facilities` é›†åˆ
2. ç‚¹å‡»"ç´¢å¼•"æ ‡ç­¾
3. ç‚¹å‡»"æ·»åŠ ç´¢å¼•"
4. å­—æ®µåï¼š`location`
5. ç´¢å¼•ç±»å‹ï¼šé€‰æ‹© `2dsphere`
6. ç‚¹å‡»"ç¡®å®š"

#### ç´¢å¼•2ï¼šçŠ¶æ€ç´¢å¼•

```json
{
  "status": 1
}
```

#### ç´¢å¼•3ï¼šè®¾æ–½ç±»å‹ç´¢å¼•

```json
{
  "facilityType": 1
}
```

#### ç´¢å¼•4ï¼šåˆ›å»ºæ—¶é—´ç´¢å¼•

```json
{
  "createTime": -1
}
```

---

## âœ… éƒ¨ç½²éªŒè¯

### 1. éªŒè¯äº‘å‡½æ•°æ˜¯å¦éƒ¨ç½²æˆåŠŸ

1. æ‰“å¼€äº‘å¼€å‘æ§åˆ¶å°
2. è¿›å…¥"äº‘å‡½æ•°"æ ‡ç­¾
3. æ£€æŸ¥æ˜¯å¦æœ‰ä»¥ä¸‹äº‘å‡½æ•°ï¼š
   - âœ… createFacility
   - âœ… updateFacilityStatus
   - âœ… getFacilities

### 2. æµ‹è¯•äº‘å‡½æ•°

#### æµ‹è¯• createFacility

åœ¨äº‘å¼€å‘æ§åˆ¶å° â†’ äº‘å‡½æ•° â†’ createFacility â†’ æµ‹è¯•ï¼Œè¾“å…¥ï¼š

```json
{
  "facilityType": "æ— éšœç¢å¡é“",
  "name": "æµ‹è¯•å¡é“",
  "latitude": 23.099994,
  "longitude": 113.324520,
  "address": "å¹¿ä¸œçœå¹¿å·å¸‚è¶Šç§€åŒºæµ‹è¯•è·¯1å·",
  "formattedAddress": "æµ‹è¯•å°åŒº1å·æ¥¼",
  "detailAddress": "1å·æ¥¼ä¸œä¾§",
  "status": "accessible",
  "images": [],
  "description": "è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•è®¾æ–½"
}
```

**æœŸæœ›ç»“æœï¼š**
```json
{
  "success": true,
  "message": "è®¾æ–½åˆ›å»ºæˆåŠŸ",
  "facilityId": "xxx",
  "data": { ... }
}
```

#### æµ‹è¯• getFacilities

```json
{
  "latitude": 23.099994,
  "longitude": 113.324520,
  "radius": 5000,
  "page": 1,
  "pageSize": 10
}
```

**æœŸæœ›ç»“æœï¼š**
```json
{
  "success": true,
  "data": [ ... ],
  "total": 1,
  "page": 1,
  "pageSize": 10,
  "hasMore": false
}
```

#### æµ‹è¯• updateFacilityStatus

```json
{
  "facilityId": "åˆšæ‰åˆ›å»ºçš„è®¾æ–½ID",
  "newStatus": "blocked",
  "images": [],
  "notes": "å‘ç°éšœç¢"
}
```

**æœŸæœ›ç»“æœï¼š**
```json
{
  "success": true,
  "message": "çŠ¶æ€æ›´æ–°æˆåŠŸ",
  "data": { ... }
}
```

---

## ğŸ”§ å¸¸è§é—®é¢˜

### é—®é¢˜1ï¼šéƒ¨ç½²å¤±è´¥ï¼Œæç¤º"äº‘å‡½æ•°ä¸å­˜åœ¨"

**è§£å†³æ–¹æ¡ˆï¼š**
1. ç¡®ä¿å·²å¼€é€šäº‘å¼€å‘
2. ç¡®ä¿äº‘å‡½æ•°ç›®å½•ç»“æ„æ­£ç¡®
3. é‡æ–°ä¸Šä¼ å¹¶éƒ¨ç½²

### é—®é¢˜2ï¼šåœ°ç†ä½ç½®æŸ¥è¯¢å¤±è´¥

**è§£å†³æ–¹æ¡ˆï¼š**
1. ç¡®ä¿å·²åˆ›å»º `location` çš„ `2dsphere` ç´¢å¼•
2. ç­‰å¾…ç´¢å¼•åˆ›å»ºå®Œæˆï¼ˆå¯èƒ½éœ€è¦å‡ åˆ†é’Ÿï¼‰
3. é‡æ–°æµ‹è¯•

### é—®é¢˜3ï¼šæƒé™é”™è¯¯

**è§£å†³æ–¹æ¡ˆï¼š**
1. ç¡®ä¿ç”¨æˆ·å·²ç™»å½•
2. ç¡®ä¿ç”¨æˆ·ä¿¡æ¯å·²ä¿å­˜åˆ° `users` é›†åˆ
3. æ£€æŸ¥ç”¨æˆ·çš„ `userType` å­—æ®µ

### é—®é¢˜4ï¼šäº‘å‡½æ•°è¶…æ—¶

**è§£å†³æ–¹æ¡ˆï¼š**
1. åœ¨äº‘å¼€å‘æ§åˆ¶å°å¢åŠ äº‘å‡½æ•°è¶…æ—¶æ—¶é—´
2. ä¼˜åŒ–æŸ¥è¯¢æ¡ä»¶ï¼Œå‡å°‘æ•°æ®é‡
3. ä½¿ç”¨åˆ†é¡µæŸ¥è¯¢

---

## ğŸ“Š éƒ¨ç½²æ£€æŸ¥æ¸…å•

éƒ¨ç½²å®Œæˆåï¼Œè¯·æ£€æŸ¥ä»¥ä¸‹é¡¹ç›®ï¼š

- [ ] `createFacility` äº‘å‡½æ•°å·²éƒ¨ç½²
- [ ] `updateFacilityStatus` äº‘å‡½æ•°å·²éƒ¨ç½²
- [ ] `getFacilities` äº‘å‡½æ•°å·²éƒ¨ç½²
- [ ] `facilities` é›†åˆå·²åˆ›å»º
- [ ] `location` å­—æ®µçš„ `2dsphere` ç´¢å¼•å·²åˆ›å»º
- [ ] `status` å­—æ®µçš„ç´¢å¼•å·²åˆ›å»º
- [ ] `facilityType` å­—æ®µçš„ç´¢å¼•å·²åˆ›å»º
- [ ] `createTime` å­—æ®µçš„ç´¢å¼•å·²åˆ›å»º
- [ ] å·²æµ‹è¯• `createFacility` äº‘å‡½æ•°
- [ ] å·²æµ‹è¯• `getFacilities` äº‘å‡½æ•°
- [ ] å·²æµ‹è¯• `updateFacilityStatus` äº‘å‡½æ•°

---

## ğŸ‰ éƒ¨ç½²å®Œæˆ

æ­å–œï¼äº‘å‡½æ•°å’Œæ•°æ®åº“å·²éƒ¨ç½²å®Œæˆã€‚

**ä¸‹ä¸€æ­¥ï¼š**
- å¼€å§‹å¼€å‘å‰ç«¯é¡µé¢
- é›†æˆäº‘å‡½æ•°åˆ°å°ç¨‹åº
- æµ‹è¯•å®Œæ•´åŠŸèƒ½

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0
**æœ€åæ›´æ–°**ï¼š2026-02-02

