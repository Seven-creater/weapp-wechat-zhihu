# 手机号和登录限制功能 - 测试清单

## ✅ 测试项目

### 1. 手机号必填测试

#### 测试1.1：不填手机号
- [ ] 打开登录页面
- [ ] 选择头像
- [ ] 输入昵称
- [ ] **不填手机号**
- [ ] 点击"完成"按钮
- [ ] **预期结果：** "完成"按钮是灰色的，无法点击

#### 测试1.2：手机号少于11位
- [ ] 输入手机号：138001380（10位）
- [ ] **预期结果：** "完成"按钮是灰色的
- [ ] 点击"完成"按钮
- [ ] **预期结果：** 提示"请输入11位手机号"

#### 测试1.3：手机号多于11位
- [ ] 输入手机号：138001380001（12位）
- [ ] **预期结果：** 自动截断为11位（13800138000）

#### 测试1.4：手机号格式错误
- [ ] 输入手机号：12345678901（第二位是2）
- [ ] 点击"完成"按钮
- [ ] **预期结果：** 提示"请输入正确的手机号"

#### 测试1.5：手机号正确
- [ ] 输入手机号：13800138000
- [ ] **预期结果：** "完成"按钮变为绿色
- [ ] 点击"完成"按钮
- [ ] **预期结果：** 登录成功

#### 测试1.6：跳过按钮
- [ ] 点击"手机号为必填项"
- [ ] **预期结果：** 提示"请填写手机号完成登录"

---

### 2. 发布限制测试

#### 测试2.1：未登录发布社区帖子
- [ ] 退出登录（如果已登录）
- [ ] 点击底部"发布"标签
- [ ] 点击"发布社区帖子"
- [ ] **预期结果：** 弹出提示"发布帖子前需要先登录，是否前往登录？"
- [ ] 点击"去登录"
- [ ] **预期结果：** 跳转到登录页面

#### 测试2.2：未登录发布无障碍问题
- [ ] 退出登录（如果已登录）
- [ ] 点击底部"发布"标签
- [ ] 点击"发布无障碍问题"
- [ ] **预期结果：** 弹出提示"发布问题前需要先登录，是否前往登录？"
- [ ] 点击"取消"
- [ ] **预期结果：** 留在当前页面

#### 测试2.3：已登录发布
- [ ] 登录账号
- [ ] 点击底部"发布"标签
- [ ] 点击"发布社区帖子"
- [ ] **预期结果：** 正常跳转到发布页面

---

### 3. 消息限制测试

#### 测试3.1：未登录查看消息
- [ ] 退出登录（如果已登录）
- [ ] 点击底部"消息"标签
- [ ] **预期结果：** 自动弹出提示"查看消息前需要先登录，是否前往登录？"
- [ ] 点击"去登录"
- [ ] **预期结果：** 跳转到登录页面

#### 测试3.2：已登录查看消息
- [ ] 登录账号
- [ ] 点击底部"消息"标签
- [ ] **预期结果：** 正常显示消息列表

---

### 4. 隐私保护测试

#### 测试4.1：本地存储检查
- [ ] 登录账号（填写手机号：13800138000）
- [ ] 打开调试器 → Storage 标签
- [ ] 查看 `userInfo` 的值
- [ ] **预期结果：** 只有 `nickName` 和 `avatarUrl`，没有 `phoneNumber`

#### 测试4.2：查看别人资料
- [ ] 登录账号A
- [ ] 查看用户B的资料
- [ ] **预期结果：** 只能看到昵称和头像，看不到手机号

#### 测试4.3：后台查看手机号
- [ ] 打开云开发控制台
- [ ] 进入数据库 → users 集合
- [ ] 查看用户记录
- [ ] **预期结果：** 可以看到 `phoneNumber` 字段

---

### 5. 完整登录流程测试

#### 测试5.1：首次登录
- [ ] 打开小程序（未登录状态）
- [ ] 点击"我的"标签
- [ ] 点击"点击登录"
- [ ] 选择头像
- [ ] 输入昵称：测试用户
- [ ] 输入手机号：13800138000
- [ ] 点击"完成"
- [ ] **预期结果：** 
  - 显示"登录中..."
  - 显示"上传头像..."
  - 显示"保存信息..."
  - 显示"登录成功"
  - 自动返回"我的"页面
  - 显示用户信息

#### 测试5.2：退出登录
- [ ] 在"我的"页面
- [ ] 点击"退出登录"
- [ ] 点击"退出"
- [ ] **预期结果：** 
  - 显示"已退出登录"
  - 页面清空
  - 显示"点击登录"提示

#### 测试5.3：重新登录
- [ ] 点击"点击登录"
- [ ] **预期结果：** 
  - 自动填充之前的头像
  - 自动填充之前的昵称
  - 自动填充之前的手机号
- [ ] 点击"完成"
- [ ] **预期结果：** 登录成功

---

### 6. 数据库验证测试

#### 测试6.1：用户记录结构
- [ ] 打开云开发控制台
- [ ] 进入数据库 → users 集合
- [ ] 查看最新的用户记录
- [ ] **预期结果：** 包含以下字段
  ```json
  {
    "_id": "xxx",
    "_openid": "oXXXX-XXXXXXXXXXXX",
    "nickName": "测试用户",
    "avatarUrl": "cloud://xxx.jpg",
    "phoneNumber": "13800138000",
    "userInfo": {
      "nickName": "测试用户",
      "avatarUrl": "cloud://xxx.jpg"
    },
    "createTime": Date,
    "updateTime": Date
  }
  ```

#### 测试6.2：手机号格式
- [ ] 检查 `phoneNumber` 字段
- [ ] **预期结果：** 
  - 长度为11位
  - 全部是数字
  - 第一位是1
  - 第二位是3-9

---

### 7. 云函数测试

#### 测试7.1：updateUserInfo 云函数
- [ ] 打开云开发控制台
- [ ] 进入云函数 → updateUserInfo
- [ ] 查看调用日志
- [ ] **预期结果：** 
  - 有调用记录
  - 返回 `success: true`
  - 不返回 `phoneNumber`

#### 测试7.2：getUserInfoAdmin 云函数
- [ ] 在云开发控制台测试云函数
- [ ] 输入参数：
  ```json
  {
    "targetOpenid": "oXXXX-XXXXXXXXXXXX"
  }
  ```
- [ ] 点击"测试"
- [ ] **预期结果：** 
  ```json
  {
    "success": true,
    "data": {
      "_id": "xxx",
      "_openid": "oXXXX-XXXXXXXXXXXX",
      "nickName": "测试用户",
      "avatarUrl": "cloud://xxx.jpg",
      "phoneNumber": "13800138000",
      "createTime": "...",
      "updateTime": "..."
    }
  }
  ```

---

## 📊 测试结果记录

### 测试环境
- 测试日期：__________
- 测试人员：__________
- 测试设备：__________
- 微信版本：__________

### 测试结果统计
- 总测试项：28项
- 通过项：____ 项
- 失败项：____ 项
- 通过率：____ %

### 问题记录

| 序号 | 测试项 | 问题描述 | 严重程度 | 状态 |
|------|--------|----------|----------|------|
| 1    |        |          | 高/中/低 | 待修复/已修复 |
| 2    |        |          | 高/中/低 | 待修复/已修复 |
| 3    |        |          | 高/中/低 | 待修复/已修复 |

---

## 🎯 关键验证点

### ✅ 必须通过的测试
1. [ ] 不填手机号无法登录
2. [ ] 手机号必须是11位
3. [ ] 手机号格式验证正确
4. [ ] 未登录无法发布帖子
5. [ ] 未登录无法查看消息
6. [ ] 手机号不存储在本地
7. [ ] 用户无法看到别人的手机号
8. [ ] 后台可以查看手机号

### ⚠️ 重要提示
- 测试前请先部署云函数
- 测试时使用真机，开发者工具可能有限制
- 测试完成后请填写测试结果记录

---

**测试完成签名：** __________
**日期：** __________








