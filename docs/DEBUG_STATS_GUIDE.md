# 🔍 统计数据调试指南

## 🎯 目标

使用调试页面查看实际的数据库数据，找出统计数据不一致的原因。

---

## 🚀 立即执行（5分钟）

### 步骤1：编译小程序（1分钟）

```
1. 保存所有文件（Ctrl+S）
2. 点击"编译"按钮
3. 小程序会自动打开调试页面
```

---

### 步骤2：查看调试信息（2分钟）

调试页面会显示：

1. **我关注的人**
   - 数量
   - 每个人的 targetId 和互关状态

2. **关注我的人**
   - 数量
   - 每个人的 followerId 和互关状态

3. **users 集合的 stats**
   - followingCount（关注数）
   - followersCount（粉丝数）
   - likesCount（获赞数）

**请截图或复制这些信息给我！**

---

### 步骤3：运行修复（2分钟）

```
1. 点击"运行修复"按钮
2. 等待修复完成
3. 查看修复结果
4. 点击"刷新数据"查看最新数据
```

---

## 📊 预期结果

### 正常情况

如果"垫底的腰间盘"关注了"李白捞月亮"：

```
【我关注的人】（垫底的腰间盘）
数量: 1
- targetId: 李白捞月亮的openid, isMutual: true

【关注我的人】（垫底的腰间盘）
数量: 0

【users 集合的 stats】（垫底的腰间盘）
followingCount: 1
followersCount: 0
likesCount: 0
```

如果"李白捞月亮"被"垫底的腰间盘"关注：

```
【我关注的人】（李白捞月亮）
数量: 0

【关注我的人】（李白捞月亮）
数量: 1
- followerId: 垫底的腰间盘的openid, isMutual: true

【users 集合的 stats】（李白捞月亮）
followingCount: 0
followersCount: 1
likesCount: 0
```

---

## 🔧 可能的问题

### 问题1：follows 集合数据正确，但 stats 不正确

**原因：** `fixUserStats` 云函数没有正确执行

**解决：** 在调试页面点击"运行修复"

---

### 问题2：follows 集合数据不正确

**原因：** 关注操作没有正确写入数据库

**解决：** 需要检查关注功能的代码

---

### 问题3：云函数调用失败

**原因：** 云函数未部署或权限问题

**解决：** 
1. 确认 `fixUserStats` 云函数已部署
2. 确认 `getUserInfo` 云函数已部署
3. 检查云函数日志

---

## 📞 下一步

**请执行以下操作：**

1. ✅ 编译小程序（会自动打开调试页面）
2. ✅ 查看显示的数据
3. ✅ 截图或复制数据给我
4. ✅ 点击"运行修复"按钮
5. ✅ 再次查看数据是否正确

**然后告诉我：**
- 调试页面显示的数据
- 运行修复后的结果
- 是否还有问题

我会根据实际数据帮您进一步排查！🔍

---

**最后更新：2026-01-30**

