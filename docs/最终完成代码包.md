# ğŸš€ æœ€ç»ˆå®Œæˆä»£ç åŒ…

## ğŸ“‹ å‰©ä½™æ–‡ä»¶æ¸…å•

ä»¥ä¸‹æ˜¯æ‰€æœ‰å‰©ä½™æ–‡ä»¶çš„å®Œæ•´ä»£ç ï¼Œç›´æ¥å¤åˆ¶ç²˜è´´å³å¯ã€‚

---

## 1. pages/project/detail/index.wxss

```css
.container {
  min-height: 100vh;
  background: #f5f7fa;
  padding: 30rpx;
  padding-bottom: 120rpx;
}

.project-header {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-radius: 24rpx;
  padding: 40rpx;
  margin-bottom: 30rpx;
  color: #fff;
}

.header-title {
  font-size: 36rpx;
  font-weight: 700;
  margin-bottom: 16rpx;
}

.header-badge {
  display: inline-block;
  padding: 8rpx 20rpx;
  background: rgba(255, 255, 255, 0.2);
  border-radius: 20rpx;
  font-size: 24rpx;
}

.project-info {
  background: #fff;
  border-radius: 24rpx;
  padding: 30rpx;
  margin-bottom: 30rpx;
  display: flex;
  flex-direction: column;
  gap: 16rpx;
}

.info-item {
  font-size: 28rpx;
  color: #333;
}

.nodes-section {
  background: #fff;
  border-radius: 24rpx;
  padding: 30rpx;
  margin-bottom: 30rpx;
}

.section-title {
  font-size: 32rpx;
  font-weight: 700;
  color: #1a1a1a;
  margin-bottom: 30rpx;
}

.nodes-timeline {
  position: relative;
}

.node-item {
  display: flex;
  gap: 24rpx;
  margin-bottom: 40rpx;
}

.node-item:last-child {
  margin-bottom: 0;
}

.node-left {
  display: flex;
  flex-direction: column;
  align-items: center;
  width: 40rpx;
}

.node-dot {
  width: 40rpx;
  height: 40rpx;
  border-radius: 50%;
  background: #e5e7eb;
  border: 4rpx solid #fff;
  box-shadow: 0 0 0 2rpx #e5e7eb;
  flex-shrink: 0;
}

.node-dot.completed {
  background: #10b981;
  box-shadow: 0 0 0 2rpx #10b981;
}

.node-line {
  flex: 1;
  width: 4rpx;
  background: #e5e7eb;
  margin: 8rpx 0;
}

.node-line.completed {
  background: #10b981;
}

.node-content {
  flex: 1;
}

.node-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16rpx;
}

.node-name {
  font-size: 30rpx;
  font-weight: 600;
  color: #333;
}

.node-status {
  font-size: 24rpx;
  color: #10b981;
}

.node-images {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 12rpx;
  margin-bottom: 16rpx;
}

.node-image {
  width: 100%;
  height: 180rpx;
  border-radius: 12rpx;
  background: #f5f5f5;
}

.node-desc {
  font-size: 26rpx;
  color: #666;
  line-height: 1.6;
  margin-bottom: 12rpx;
}

.node-time {
  font-size: 24rpx;
  color: #999;
}

.update-node-btn {
  padding: 16rpx 32rpx;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: #fff;
  border-radius: 12rpx;
  font-size: 26rpx;
  border: none;
}

.confirm-section {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  padding: 20rpx 30rpx;
  background: #fff;
  box-shadow: 0 -4rpx 16rpx rgba(0, 0, 0, 0.05);
}

.confirm-btn {
  width: 100%;
  height: 88rpx;
  background: linear-gradient(135deg, #10b981 0%, #059669 100%);
  color: #fff;
  font-size: 32rpx;
  font-weight: 600;
  border-radius: 16rpx;
  border: none;
}

.loading {
  padding: 100rpx 0;
  text-align: center;
  font-size: 28rpx;
  color: #999;
}
```

---

## 2. pages/project/detail/index.json

```json
{
  "navigationBarTitleText": "é¡¹ç›®è¯¦æƒ…",
  "navigationBarBackgroundColor": "#667eea",
  "navigationBarTextStyle": "white",
  "enablePullDownRefresh": true
}
```

---

## 3. pages/project/update/index.js

```javascript
const app = getApp();

Page({
  data: {
    projectId: '',
    nodeIndex: 0,
    nodeName: '',
    
    images: [],
    description: '',
    actualCost: '',
    
    maxImages: 9,
    submitting: false
  },

  onLoad(options) {
    if (options.projectId && options.nodeIndex !== undefined) {
      const nodeNames = ['å‡†å¤‡', 'æ–½å·¥', 'éªŒæ”¶'];
      this.setData({
        projectId: options.projectId,
        nodeIndex: parseInt(options.nodeIndex),
        nodeName: nodeNames[parseInt(options.nodeIndex)]
      });
    }
  },

  onDescInput(e) {
    this.setData({ description: e.detail.value });
  },

  onCostInput(e) {
    this.setData({ actualCost: e.detail.value });
  },

  chooseImage() {
    const currentCount = this.data.images.length;
    if (currentCount >= this.data.maxImages) {
      wx.showToast({ title: `æœ€å¤š${this.data.maxImages}å¼ `, icon: 'none' });
      return;
    }

    wx.chooseMedia({
      count: this.data.maxImages - currentCount,
      mediaType: ['image'],
      sourceType: ['album', 'camera'],
      success: (res) => {
        const newImages = res.tempFiles.map(file => file.tempFilePath);
        this.setData({ images: [...this.data.images, ...newImages] });
      }
    });
  },

  removeImage(e) {
    const index = e.currentTarget.dataset.index;
    const images = [...this.data.images];
    images.splice(index, 1);
    this.setData({ images });
  },

  previewImage(e) {
    const current = e.currentTarget.dataset.src;
    wx.previewImage({ current, urls: this.data.images });
  },

  uploadImages() {
    if (this.data.images.length === 0) return Promise.resolve([]);

    const uploadPromises = this.data.images.map((path, index) => {
      const cloudPath = `projects/${Date.now()}-${index}.jpg`;
      return wx.cloud.uploadFile({ cloudPath, filePath: path })
        .then(res => res.fileID);
    });

    return Promise.all(uploadPromises);
  },

  submitUpdate() {
    if (this.data.images.length === 0) {
      wx.showToast({ title: 'è¯·ä¸Šä¼ ç…§ç‰‡', icon: 'none' });
      return;
    }

    if (this.data.submitting) return;

    this.setData({ submitting: true });
    wx.showLoading({ title: 'æäº¤ä¸­...' });

    this.uploadImages().then(fileIDs => {
      return wx.cloud.callFunction({
        name: 'updateProjectNode',
        data: {
          projectId: this.data.projectId,
          nodeIndex: this.data.nodeIndex,
          images: fileIDs,
          description: this.data.description,
          actualCost: Number(this.data.actualCost) || 0
        }
      });
    }).then(res => {
      wx.hideLoading();
      this.setData({ submitting: false });

      if (res.result && res.result.success) {
        wx.showToast({ title: 'æ›´æ–°æˆåŠŸ', icon: 'success' });
        setTimeout(() => wx.navigateBack(), 1500);
      } else {
        throw new Error(res.result?.error || 'æ›´æ–°å¤±è´¥');
      }
    }).catch(err => {
      wx.hideLoading();
      this.setData({ submitting: false });
      wx.showToast({ title: err.message || 'æ›´æ–°å¤±è´¥', icon: 'none' });
    });
  }
});
```

---

## 4. pages/project/update/index.wxml

```xml
<view class="container">
  <view class="node-info">
    <text class="node-title">æ›´æ–°èŠ‚ç‚¹: {{nodeName}}</text>
  </view>

  <view class="form-section">
    <view class="form-item">
      <view class="form-label">ç°åœºç…§ç‰‡ *</view>
      <view class="images-grid">
        <view wx:for="{{images}}" wx:key="index" class="image-item">
          <image class="image-preview" src="{{item}}" mode="aspectFill" bindtap="previewImage" data-src="{{item}}" />
          <view class="remove-btn" bindtap="removeImage" data-index="{{index}}">âœ•</view>
        </view>
        <view wx:if="{{images.length < maxImages}}" class="add-image-btn" bindtap="chooseImage">
          <text class="add-icon">+</text>
          <text class="add-text">æ·»åŠ ç…§ç‰‡</text>
        </view>
      </view>
    </view>

    <view class="form-item">
      <view class="form-label">å·¥ä½œæè¿°</view>
      <textarea class="form-textarea" placeholder="è¯·æè¿°æœ¬é˜¶æ®µçš„å·¥ä½œå†…å®¹..." value="{{description}}" bindinput="onDescInput" maxlength="500" />
    </view>

    <view class="form-item">
      <view class="form-label">å®é™…æ¶ˆè€—ï¼ˆå…ƒï¼‰</view>
      <input class="form-input" type="digit" placeholder="è¯·è¾“å…¥å®é™…æ¶ˆè€—é‡‘é¢" value="{{actualCost}}" bindinput="onCostInput" />
    </view>
  </view>

  <view class="submit-section">
    <button class="submit-btn {{submitting ? 'disabled' : ''}}" bindtap="submitUpdate" disabled="{{submitting}}">
      {{submitting ? 'æäº¤ä¸­...' : 'æäº¤æ›´æ–°'}}
    </button>
  </view>
</view>
```

---

## 5. pages/project/update/index.wxss

```css
.container {
  min-height: 100vh;
  background: #f5f7fa;
  padding: 30rpx;
  padding-bottom: 120rpx;
}

.node-info {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-radius: 24rpx;
  padding: 40rpx;
  margin-bottom: 30rpx;
}

.node-title {
  font-size: 36rpx;
  font-weight: 700;
  color: #fff;
}

.form-section {
  background: #fff;
  border-radius: 24rpx;
  padding: 30rpx;
}

.form-item {
  margin-bottom: 30rpx;
}

.form-item:last-child {
  margin-bottom: 0;
}

.form-label {
  font-size: 28rpx;
  font-weight: 600;
  color: #333;
  margin-bottom: 16rpx;
}

.images-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 16rpx;
}

.image-item {
  position: relative;
  width: 100%;
  padding-bottom: 100%;
}

.image-preview {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  border-radius: 16rpx;
  background: #f5f5f5;
}

.remove-btn {
  position: absolute;
  top: -12rpx;
  right: -12rpx;
  width: 48rpx;
  height: 48rpx;
  background: #ff4d4f;
  color: #fff;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 32rpx;
}

.add-image-btn {
  width: 100%;
  padding-bottom: 100%;
  position: relative;
  border: 3rpx dashed #d0d0d0;
  border-radius: 16rpx;
  background: #fafafa;
}

.add-icon {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -80%);
  font-size: 64rpx;
  color: #999;
}

.add-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, 40%);
  font-size: 24rpx;
  color: #999;
}

.form-textarea {
  width: 100%;
  min-height: 200rpx;
  padding: 20rpx;
  background: #f8f9fa;
  border-radius: 12rpx;
  font-size: 28rpx;
  line-height: 1.6;
}

.form-input {
  width: 100%;
  height: 80rpx;
  padding: 0 24rpx;
  background: #f8f9fa;
  border-radius: 12rpx;
  font-size: 28rpx;
}

.submit-section {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  padding: 20rpx 30rpx;
  background: #fff;
  box-shadow: 0 -4rpx 16rpx rgba(0, 0, 0, 0.05);
}

.submit-btn {
  width: 100%;
  height: 88rpx;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: #fff;
  font-size: 32rpx;
  font-weight: 600;
  border-radius: 16rpx;
  border: none;
}

.submit-btn.disabled {
  opacity: 0.6;
}
```

---

## 6. pages/project/update/index.json

```json
{
  "navigationBarTitleText": "æ›´æ–°è¿›åº¦",
  "navigationBarBackgroundColor": "#667eea",
  "navigationBarTextStyle": "white"
}
```

---

## 7. pages/cases/index.js

```javascript
Page({
  data: {
    categories: ['å…¨éƒ¨', 'æ— éšœç¢åœè½¦ä½', 'æ— éšœç¢å«ç”Ÿé—´', 'æ— éšœç¢å¡é“', 'æ— éšœç¢ç”µæ¢¯', 'æ— éšœç¢å‡é™å°'],
    currentCategory: 'å…¨éƒ¨',
    cases: [],
    page: 1,
    hasMore: true,
    loading: false
  },

  onLoad() {
    this.loadCases();
  },

  switchCategory(e) {
    const category = e.currentTarget.dataset.category;
    this.setData({
      currentCategory: category,
      page: 1,
      cases: [],
      hasMore: true
    }, () => {
      this.loadCases();
    });
  },

  loadCases() {
    if (this.data.loading || !this.data.hasMore) return;

    this.setData({ loading: true });

    wx.cloud.callFunction({
      name: 'getCases',
      data: {
        category: this.data.currentCategory === 'å…¨éƒ¨' ? null : this.data.currentCategory,
        page: this.data.page,
        pageSize: 10
      }
    }).then(res => {
      if (res.result && res.result.success) {
        this.setData({
          cases: [...this.data.cases, ...res.result.data],
          hasMore: res.result.hasMore,
          loading: false
        });
      }
    }).catch(err => {
      this.setData({ loading: false });
      wx.showToast({ title: 'åŠ è½½å¤±è´¥', icon: 'none' });
    });
  },

  viewCase(e) {
    const id = e.currentTarget.dataset.id;
    wx.navigateTo({
      url: `/pages/cases/detail/index?id=${id}`
    });
  },

  onReachBottom() {
    if (this.data.hasMore) {
      this.setData({ page: this.data.page + 1 }, () => {
        this.loadCases();
      });
    }
  }
});
```

---

## ä½¿ç”¨è¯´æ˜

1. **å¤åˆ¶ä¸Šè¿°ä»£ç **åˆ°å¯¹åº”æ–‡ä»¶
2. **åˆ›å»ºç¼ºå¤±çš„å›¾ç‰‡èµ„æº**ï¼ˆå¦‚ /images/empty.pngï¼‰
3. **éƒ¨ç½²æ‰€æœ‰äº‘å‡½æ•°**
4. **æµ‹è¯•åŠŸèƒ½**

**é¢„è®¡å®Œæˆæ—¶é—´ï¼š30åˆ†é’Ÿ**

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv2.0  
**æ›´æ–°æ—¶é—´**ï¼š2026-02-02



