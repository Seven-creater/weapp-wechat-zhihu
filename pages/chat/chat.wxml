<view class="chat-container">
  <scroll-view 
    class="message-list" 
    scroll-y 
    scroll-into-view="{{toView}}" 
    scroll-with-animation
    bindtap="hideKeyboard"
  >
    <view class="loading-more" wx:if="{{loading}}">
      <text>加载中...</text>
    </view>

    <block wx:for="{{messages}}" wx:key="_id">
      <view class="message-item {{item.isMy ? 'my-message' : 'other-message'}}" id="msg-{{item._id}}">
        <image 
          class="avatar" 
          src="{{item.isMy ? userInfo.avatarUrl : targetUserInfo.avatarUrl}}" 
          mode="aspectFill" 
          bindtap="{{item.isMy ? 'onMyAvatarTap' : 'onTargetAvatarTap'}}"
        />
        <view class="content-wrapper">
          <view class="content-bubble">
            <text>{{item.content}}</text>
          </view>
        </view>
      </view>
    </block>
    
    <!-- Anchor for scrolling to bottom -->
    <view id="bottom-anchor" style="height: 20rpx;"></view>
  </scroll-view>

  <view class="input-area">
    <input 
      class="chat-input" 
      value="{{inputValue}}" 
      bindinput="onInput" 
      bindfocus="onFocus" 
      bindblur="onBlur"
      confirm-type="send" 
      bindconfirm="sendMessage"
      placeholder="发消息..." 
      adjust-position="{{true}}"
      hold-keyboard="{{false}}"
    />
    <view class="send-btn {{inputValue ? 'active' : ''}}" bindtap="sendMessage">发送</view>
  </view>
</view>
