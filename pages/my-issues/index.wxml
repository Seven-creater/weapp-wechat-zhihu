<view class="my-issues-container">
  <view class="page-header">
    <text class="page-title">我的发布历史</text>
    <text class="page-subtitle">查看我上报的反馈和发布的帖子</text>
  </view>

  <view class="tab-bar">
    <view class="tab-item {{currentTab === 'issues' ? 'active' : ''}}" bindtap="onTabChange" data-tab="issues">
      <text class="tab-text">路障反馈</text>
      <view class="tab-indicator" wx:if="{{currentTab === 'issues'}}"></view>
    </view>
    <view class="tab-item {{currentTab === 'posts' ? 'active' : ''}}" bindtap="onTabChange" data-tab="posts">
      <text class="tab-text">社区帖子</text>
      <view class="tab-indicator" wx:if="{{currentTab === 'posts'}}"></view>
    </view>
  </view>

  <view class="tab-content">
    <block wx:if="{{currentTab === 'issues'}}">
      <view class="empty-state" wx:if="{{issues.length === 0 && !loading}}">
        <image src="/images/empty-issues.png" class="empty-image"></image>
        <text class="empty-text">暂无路障反馈记录</text>
        <text class="empty-desc">快去首页拍照上报无障碍问题吧</text>
        <button class="empty-btn" bindtap="goToHome" aria-label="去首页">去首页拍照</button>
      </view>

      <view class="issues-list" wx:if="{{issues.length > 0}}">
        <view class="issue-item" wx:for="{{issues}}" wx:key="_id" bindtap="goToIssueDetail" data-id="{{item._id}}">
          <view class="item-image">
            <image src="{{item.imageUrl}}" mode="aspectFill"></image>
            <view class="status-tag {{item.status === 'pending' ? 'waiting' : 'solved'}}">
              {{item.status === 'pending' ? '待处理' : '已解决'}}
            </view>
          </view>
          
          <view class="item-content">
            <text class="item-title">{{item.description || '无障碍问题'}}</text>
            <text class="item-location">{{item.address || item.formattedAddress || '位置信息获取中'}}</text>
            <text class="item-time">{{item.createTime}}</text>
            
            <view class="ai-suggestion" wx:if="{{item.aiAnalysis}}">
              <text class="suggestion-label">AI建议：</text>
              <text class="suggestion-text">{{item.aiAnalysis.length > 30 ? item.aiAnalysis.substring(0, 30) + '...' : item.aiAnalysis}}</text>
            </view>
          </view>
          
          <view class="item-arrow">
            <image src="/images/arrow-right-yellow.png" class="arrow-icon"></image>
          </view>
        </view>
      </view>
    </block>

    <block wx:if="{{currentTab === 'posts'}}">
      <view class="empty-state" wx:if="{{posts.length === 0 && !loading}}">
        <image src="/images/empty-posts.png" class="empty-image"></image>
        <text class="empty-text">暂无社区帖子</text>
        <text class="empty-desc">快去社区发布帖子分享你的观点吧</text>
        <button class="empty-btn" bindtap="goToHome" aria-label="去社区">去社区看看</button>
      </view>

      <view class="posts-list" wx:if="{{posts.length > 0}}">
        <view class="post-item" wx:for="{{posts}}" wx:key="_id" bindtap="goToPostDetail" data-id="{{item._id}}">
          <view class="post-header">
            <image class="post-avatar" src="{{item.userInfo.avatarUrl || '/images/default-avatar.png'}}"></image>
            <view class="post-user-info">
              <text class="post-user-name">{{item.userInfo.nickName || '匿名用户'}}</text>
              <text class="post-time">{{item.createTime}}</text>
            </view>
          </view>
          
          <view class="post-content">
            <text class="post-text">{{item.content.length > 50 ? item.content.substring(0, 50) + '...' : item.content}}</text>
          </view>
          
          <view class="post-footer" wx:if="{{item.images && item.images.length > 0}}">
            <image class="post-thumbnail" src="{{item.images[0]}}" mode="aspectFill"></image>
          </view>
          
          <view class="post-stats">
            <view class="stat-item">
              <image class="stat-icon" src="/images/icon-like.png"></image>
              <text class="stat-text">{{item.stats.like || 0}}</text>
            </view>
            <view class="stat-item">
              <image class="stat-icon" src="/images/icon-comment.png"></image>
              <text class="stat-text">{{item.stats.comment || 0}}</text>
            </view>
          </view>
        </view>
      </view>
    </block>

    <view class="loading-state" wx:if="{{loading}}">
      <text class="loading-text">加载中...</text>
    </view>

    <view class="load-more" wx:if="{{currentTab === 'issues' ? (issuesHasMore && !loading) : (postsHasMore && !loading)}}" bindtap="{{currentTab === 'issues' ? 'loadMoreIssues' : 'loadMorePosts'}}">
      <text>加载更多</text>
    </view>
    
    <view class="no-more" wx:if="{{currentTab === 'issues' ? (!issuesHasMore && issues.length > 0) : (!postsHasMore && posts.length > 0)}}">
      <text>没有更多数据了</text>
    </view>
  </view>
</view>
