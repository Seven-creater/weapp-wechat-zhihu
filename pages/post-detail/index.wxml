<view class="post-detail-container">
  <!-- å¸–å­è¯¦æƒ…å†…å®¹ -->
  <view class="post-content-section" wx:if="{{post}}">
    <!-- å¸–å­å¤´éƒ¨ -->
    <view class="user-info-card">
      <image class="avatar" src="{{post.userInfo.avatarUrl}}" mode="aspectFill" aria-hidden="true"></image>
      
      <view class="info-right">
        <!-- ç¬¬ä¸€è¡Œï¼šåå­— + æ ‡ç­¾ -->
        <view class="name-row">
          <text class="nickname">{{post.userInfo.nickName}}</text>
          <!-- è·¯éšœåé¦ˆæ ‡ç­¾ -->
          <view class="tag-badge" wx:if="{{post.type === 'issue'}}">
            <text class="tag-icon">ğŸš§</text>
            <text>è·¯éšœåé¦ˆ</text>
          </view>
          <view class="tag-badge tag-help" wx:elif="{{post.type === 'help'}}">
            <text class="tag-icon">â“</text>
            <text>æ±‚åŠ©</text>
          </view>
          <view class="tag-badge tag-share" wx:elif="{{post.type === 'share'}}">
            <text class="tag-icon">ğŸ’¬</text>
            <text>åˆ†äº«</text>
          </view>
        </view>
        
        <!-- ç¬¬äºŒè¡Œï¼šæ—¶é—´ + åˆ é™¤æŒ‰é’® -->
        <view class="time-row">
          <text class="time">{{post.createTime}}</text>
          
          <!-- åˆ é™¤æŒ‰é’®ï¼šçº¢è‰²åœ†è§’æ ·å¼ -->
          <view 
            class="delete-btn" 
            bindtap="deletePost" 
            wx:if="{{post.isOwner}}"
            data-postid="{{post._id}}"
            aria-role="button"
            aria-label="åˆ é™¤å¸–å­"
          >
            <text>åˆ é™¤</text>
          </view>
        </view>
      </view>
    </view>

    <!-- å¸–å­å†…å®¹ -->
    <view class="post-content">
      <text class="content-text" user-select="true">{{post.content}}</text>
    </view>

    <!-- å®šä½ä¿¡æ¯ -->
    <view class="location-card" wx:if="{{post.address}}">
      <image class="location-icon" src="/images/location.png" aria-hidden="true"></image>
      <view class="location-info">
        <text class="location-label">é—®é¢˜ä½ç½®</text>
        <text class="location-text">{{post.address}}</text>
      </view>
    </view>

    <!-- å›¾ç‰‡å±•ç¤º -->
    <view class="post-images" wx:if="{{post.images && post.images.length > 0}}">
      <view class="image-grid">
        <image 
          class="post-image" 
          wx:for="{{post.images}}" 
          wx:key="index" 
          wx:for-item="img"
          src="{{img}}" 
          mode="aspectFill"
          bindtap="previewImage"
          data-current="{{img}}"
          data-urls="{{post.images}}"
          aria-label="å¸–å­å›¾ç‰‡{{index + 1}}"
        ></image>
      </view>
    </view>

    <!-- åº•éƒ¨æ“ä½œæ  -->
    <view class="post-actions">
      <view 
        class="action-btn like-btn {{post.liked ? 'liked' : ''}}" 
        bindtap="likePost"
        aria-role="button"
        aria-label="{{post.liked ? 'å–æ¶ˆç‚¹èµ' : 'ç‚¹èµ'}}ï¼Œå½“å‰{{post.stats.like}}ä¸ªèµ"
      >
        <image 
          class="action-icon" 
          src="{{post.liked ? 'https://s1.ax1x.com/2022/04/27/LqVd34.png' : 'https://s1.ax1x.com/2022/04/27/LqVuOU.png'}}"
          mode="aspectFit"
          aria-hidden="true"
        ></image>
        <text class="action-text {{post.liked ? 'liked-text' : ''}}">{{post.stats.like}}</text>
      </view>

      <view 
        class="action-btn comment-btn" 
        bindtap="showCommentInput"
        aria-role="button"
        aria-label="å‘è¡¨è¯„è®ºï¼Œå½“å‰{{post.stats.comment}}æ¡è¯„è®º"
      >
        <image class="action-icon" src="/images/comment.png" aria-hidden="true"></image>
        <text class="action-text">{{post.stats.comment}}</text>
      </view>

      <view 
        class="action-btn collect-btn {{isCollected ? 'collected' : ''}}" 
        bindtap="toggleCollect"
        aria-role="button"
        aria-label="{{isCollected ? 'å–æ¶ˆæ”¶è—' : 'æ”¶è—'}}ï¼Œå½“å‰{{collectCount}}äººæ”¶è—"
      >
        <image class="action-icon" src="{{isCollected ? '/images/star2.png' : '/images/star.png'}}" aria-hidden="true"></image>
        <text class="action-text">{{collectCount}}</text>
      </view>

      <view 
        class="action-btn share-btn" 
        bindtap="sharePost"
        aria-role="button"
        aria-label="åˆ†äº«å¸–å­"
      >
        <image class="action-icon" src="/images/share.png" aria-hidden="true"></image>
        <text class="action-text">åˆ†äº«</text>
      </view>
    </view>
  </view>

  <!-- è¯„è®ºåŒº -->
  <view class="comments-section">
    <view class="section-header">
      <text class="section-title">è¯„è®º</text>
      <text class="comment-count">{{comments.length}}æ¡</text>
    </view>

    <!-- è¯„è®ºåˆ—è¡¨ -->
    <view class="comments-list">
      <view class="comment-item" wx:for="{{comments}}" wx:key="_id">
        <!-- ä¸»è¯„è®º -->
        <view class="main-comment">
          <image class="comment-avatar" src="{{item.userInfo.avatarUrl}}" aria-hidden="true"></image>
          <view class="comment-content">
            <view class="comment-header">
              <text class="comment-author">{{item.userInfo.nickName}}</text>
              <text class="comment-time">{{item.createTime}}</text>
            </view>
            <text class="comment-text" user-select="true">{{item.content}}</text>
            <view class="comment-actions">
              <view
                class="comment-action like-action {{item.liked ? 'liked' : ''}}"
                bindtap="likeComment"
                data-commentid="{{item._id}}"
                aria-role="button"
                aria-label="{{item.liked ? 'å–æ¶ˆç‚¹èµ' : 'ç‚¹èµ'}}è¯„è®ºï¼Œå½“å‰{{item.likes}}ä¸ªèµ"
              >
                <image class="action-icon" src="/images/like{{item.liked ? '-active' : ''}}-small.png" aria-hidden="true"></image>
                <text class="action-text">{{item.likes}}</text>
              </view>
              <view
                class="comment-action reply-action"
                bindtap="showCommentInput"
                data-replyto="{{item._id}}"
                aria-role="button"
                aria-label="å›å¤{{item.userInfo.nickName}}çš„è¯„è®º"
              >
                <text class="action-text">å›å¤</text>
              </view>
              <view
                class="comment-action delete-action"
                wx:if="{{item.isOwner}}"
                bindtap="deleteComment"
                data-commentid="{{item._id}}"
                aria-role="button"
                aria-label="åˆ é™¤è¯„è®º"
              >
                <text class="action-text">åˆ é™¤</text>
              </view>
            </view>
          </view>
        </view>

        <!-- å›å¤åˆ—è¡¨ -->
        <view class="replies-list" wx:if="{{item.replies && item.replies.length > 0}}">
          <view class="reply-item" wx:for="{{item.replies}}" wx:key="_id">
            <image class="reply-avatar" src="{{item.userInfo.avatarUrl}}" aria-hidden="true"></image>
            <view class="reply-content">
              <view class="reply-header">
                <text class="reply-author">{{item.userInfo.nickName}}</text>
                <text class="reply-time">{{item.createTime}}</text>
              </view>
              <text class="reply-text" user-select="true">{{item.content}}</text>
              <view class="reply-actions">
                <view 
                  class="reply-action like-action {{item.liked ? 'liked' : ''}}" 
                  bindtap="likeComment" 
                  data-commentid="{{item._id}}" 
                  data-isreply="true" 
                  data-parentid="{{item.parentId}}"
                  aria-role="button"
                  aria-label="{{item.liked ? 'å–æ¶ˆç‚¹èµ' : 'ç‚¹èµ'}}å›å¤ï¼Œå½“å‰{{item.likes}}ä¸ªèµ"
                >
                  <image class="action-icon" src="/images/like{{item.liked ? '-active' : ''}}-small.png" aria-hidden="true"></image>
                  <text class="action-text">{{item.likes}}</text>
                </view>
                <view
                  class="reply-action reply-action"
                  bindtap="showCommentInput"
                  data-replyto="{{item._id}}"
                  aria-role="button"
                  aria-label="å›å¤{{item.userInfo.nickName}}çš„è¯„è®º"
                >
                  <text class="action-text">å›å¤</text>
                </view>
                <view
                  class="reply-action delete-action"
                  wx:if="{{item.isOwner}}"
                  bindtap="deleteComment"
                  data-commentid="{{item._id}}"
                  data-isreply="true"
                  data-parentid="{{item.parentId}}"
                  aria-role="button"
                  aria-label="åˆ é™¤å›å¤"
                >
                  <text class="action-text">åˆ é™¤</text>
                </view>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- ç©ºè¯„è®ºçŠ¶æ€ -->
    <view class="empty-comments" wx:if="{{comments.length === 0}}">
      <image class="empty-icon" src="/images/empty-comments.png" aria-hidden="true"></image>
      <text class="empty-text">æš‚æ— è¯„è®º</text>
      <text class="empty-subtext">å¿«æ¥å‘è¡¨ç¬¬ä¸€æ¡è¯„è®ºå§</text>
    </view>
  </view>

  <!-- åº•éƒ¨è¯„è®ºè¾“å…¥æ  -->
  <view class="footer-input-bar">
    <view class="input-wrapper">
      <!-- è¿™é‡Œçš„ placeholder å°±æ˜¯ä½ è¦çš„è¿™å››ä¸ªå­— -->
      <input 
        class="input-field" 
        placeholder="å‘è¡¨è¯„è®º" 
        placeholder-style="color: #999;" 
        bindinput="onCommentInput"
        value="{{newComment}}"
        confirm-type="send"
        aria-label="è¯„è®ºè¾“å…¥æ¡†"
      />
    </view>
    <view class="send-btn" bindtap="submitComment" aria-role="button" aria-label="å‘é€è¯„è®º">å‘é€</view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-state" wx:if="{{loading}}">
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>
</view>
