<view class="issue-edit-container">
  <view class="header">
    <view class="back-btn" bindtap="handleCancel" aria-role="button" aria-label="è¿”å›">
      <image class="back-icon" src="/images/arrow-right-yellow.png" style="transform: rotate(180deg);"></image>
    </view>
    <text class="title">é—®é¢˜ç¼–è¾‘</text>
    <view class="header-right"></view>
  </view>

  <view class="section">
    <text class="section-title">é—®é¢˜è¯´æ˜</text>
    <textarea
      class="description-input"
      placeholder="è¯·æè¿°é—®é¢˜ç°çŠ¶..."
      value="{{description}}"
      maxlength="500"
      show-confirm-bar="false"
      bindinput="onDescriptionInput"
      aria-label="é—®é¢˜è¯´æ˜"
    ></textarea>
    <view class="input-footer">
      <view class="word-count">{{description.length}}/500</view>
      <view 
        class="voice-btn {{isRecording ? 'recording' : ''}}"
        catchtouchstart="streamRecord"
        catchtouchend="endStreamRecord"
        aria-role="button"
        aria-label="{{isRecording ? 'æ­£åœ¨å½•éŸ³ï¼Œæ¾å¼€ç»“æŸ' : 'æŒ‰ä½è¯´è¯'}}"
      >
        <text class="voice-icon">{{isRecording ? 'ğŸ¤' : 'ğŸ™ï¸'}}</text>
        <text class="voice-text">{{isRecording ? 'å½•éŸ³ä¸­' : 'æŒ‰ä½è¯´è¯'}}</text>
      </view>
    </view>
  </view>

  <view class="section">
    <view class="section-header">
      <text class="section-title">ç°åœºç…§ç‰‡</text>
      <text class="section-subtitle">{{images.length}}/9</text>
    </view>
    <view class="image-list">
      <view
        class="image-item"
        wx:for="{{images}}"
        wx:key="index"
        aria-role="button"
        aria-label="å›¾ç‰‡{{index + 1}}"
      >
        <image
          class="uploaded-image"
          src="{{item.path}}"
          mode="aspectFill"
          bindtap="previewImage"
          data-src="{{item.path}}"
        ></image>
        <view class="remove-btn" bindtap="removeImage" data-index="{{index}}" aria-role="button" aria-label="åˆ é™¤å›¾ç‰‡">
          <text class="remove-icon" aria-hidden="true">Ã—</text>
        </view>
      </view>
      <view class="add-image-btn" wx:if="{{images.length < 9}}" bindtap="chooseImage" aria-role="button" aria-label="æ·»åŠ å›¾ç‰‡">
        <image class="add-icon" src="/images/add-image.png" aria-hidden="true"></image>
        <text class="add-text">ç»§ç»­æ·»åŠ </text>
      </view>
    </view>
  </view>

  <view class="section">
    <view class="section-header">
      <text class="section-title">ä½ç½®ä¿¡æ¯</text>
      <view class="reselect-btn" bindtap="chooseLocation" aria-role="button" aria-label="é‡æ–°å®šä½">
        <text>é‡æ–°é€‰ç‚¹</text>
      </view>
    </view>
    <text class="location-text">{{formattedAddress || address || 'æš‚æœªé€‰æ‹©ä½ç½®'}}</text>
  </view>

  <view class="section">
    <view class="section-header">
      <text class="section-title">AI æ–¹æ¡ˆ</text>
      <view class="ai-btn" bindtap="generateAISolution" aria-role="button" aria-label="ç”ŸæˆAIæ–¹æ¡ˆ">
        <text>{{aiSolution ? 'é‡æ–°ç”Ÿæˆ' : 'ç”Ÿæˆæ–¹æ¡ˆ'}}</text>
      </view>
    </view>
    <view class="ai-content">
      <text class="ai-text" user-select="true">{{aiSolution || 'å°šæœªç”Ÿæˆ AI æ–¹æ¡ˆ'}}</text>
    </view>
  </view>

  <view class="section">
    <view class="switch-row">
      <text class="switch-label">åŒæ­¥åˆ°ç¤¾åŒº</text>
      <switch checked="{{syncToCommunity}}" bindchange="onSyncChange" aria-label="åŒæ­¥åˆ°ç¤¾åŒº"></switch>
    </view>
  </view>

  <view class="footer-actions">
    <button class="submit-btn" bindtap="submitIssue" aria-label="æäº¤">
      æäº¤å¹¶ç”Ÿæˆæ–¹æ¡ˆåº“
    </button>
  </view>

  <view class="loading-mask" wx:if="{{generatingAI || submitting}}">
    <view class="loading-content">
      <image class="loading-icon" src="/images/loading.gif" aria-hidden="true"></image>
      <text class="loading-text">{{generatingAI ? 'AI ç”Ÿæˆä¸­...' : 'æäº¤ä¸­...'}} </text>
    </view>
  </view>
</view>
