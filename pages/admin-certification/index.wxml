<!-- pages/admin-certification/index.wxml -->
<view class="admin-container">
  <!-- é¡¶éƒ¨æ ‡é¢˜ -->
  <view class="header">
    <text class="header-title">ğŸ” ç¤¾åŒºå·¥ä½œè€…è®¤è¯å®¡æ ¸</text>
    <text class="header-subtitle">å®¡æ ¸ç¤¾åŒºå·¥ä½œè€…çš„èº«ä»½è®¤è¯ç”³è¯·</text>
  </view>

  <!-- ç»Ÿè®¡å¡ç‰‡ -->
  <view class="stats-cards">
    <view class="stat-card pending">
      <text class="stat-number">{{stats.pending}}</text>
      <text class="stat-label">å¾…å®¡æ ¸</text>
    </view>
    <view class="stat-card approved">
      <text class="stat-number">{{stats.approved}}</text>
      <text class="stat-label">å·²é€šè¿‡</text>
    </view>
    <view class="stat-card rejected">
      <text class="stat-number">{{stats.rejected}}</text>
      <text class="stat-label">å·²æ‹’ç»</text>
    </view>
  </view>

  <!-- ç­›é€‰æ ‡ç­¾ -->
  <view class="filter-tabs">
    <view 
      class="filter-tab {{currentFilter === 'pending' ? 'active' : ''}}"
      bindtap="switchFilter"
      data-filter="pending"
    >
      å¾…å®¡æ ¸ ({{stats.pending}})
    </view>
    <view 
      class="filter-tab {{currentFilter === 'approved' ? 'active' : ''}}"
      bindtap="switchFilter"
      data-filter="approved"
    >
      å·²é€šè¿‡
    </view>
    <view 
      class="filter-tab {{currentFilter === 'rejected' ? 'active' : ''}}"
      bindtap="switchFilter"
      data-filter="rejected"
    >
      å·²æ‹’ç»
    </view>
  </view>

  <!-- ç”³è¯·åˆ—è¡¨ -->
  <view class="applications-list">
    <block wx:for="{{applications}}" wx:key="_id">
      <view class="application-card">
        <!-- ç”¨æˆ·ä¿¡æ¯ -->
        <view class="user-info">
          <image class="user-avatar" src="{{item.avatarUrl}}" mode="aspectFill" />
          <view class="user-details">
            <text class="user-name">{{item.nickName}}</text>
            <text class="apply-time">ç”³è¯·æ—¶é—´ï¼š{{item.applyTime}}</text>
          </view>
        </view>

        <!-- è®¤è¯ä¿¡æ¯ -->
        <view class="cert-info">
          <!-- è”ç³»ç”µè¯ï¼ˆæ‰€æœ‰è§’è‰²éƒ½æœ‰ï¼‰ -->
          <view class="cert-item">
            <text class="cert-label">ğŸ“± è”ç³»ç”µè¯ï¼š</text>
            <text class="cert-value">{{item.phoneNumber}}</text>
          </view>
          
          <!-- ç¤¾åŒºå·¥ä½œè€…è®¤è¯ä¿¡æ¯ -->
          <block wx:if="{{item.userType === 'communityWorker'}}">
            <view class="cert-item">
              <text class="cert-label">ğŸ˜ï¸ æ‰€å±ç¤¾åŒºï¼š</text>
              <text class="cert-value">{{item.community}}</text>
            </view>
            <view class="cert-item">
              <text class="cert-label">ğŸ‘” èŒä½ï¼š</text>
              <text class="cert-value">{{item.position}}</text>
            </view>
            <view class="cert-item">
              <text class="cert-label">ğŸ†” å·¥ä½œè¯å·ï¼š</text>
              <text class="cert-value">{{item.workId}}</text>
            </view>
          </block>
          
          <!-- æ–½å·¥æ–¹è®¤è¯ä¿¡æ¯ -->
          <block wx:if="{{item.userType === 'contractor'}}">
            <view class="cert-item">
              <text class="cert-label">ğŸ¢ å…¬å¸åç§°ï¼š</text>
              <text class="cert-value">{{item.companyName}}</text>
            </view>
            <view class="cert-item">
              <text class="cert-label">ğŸ‘¤ è”ç³»äººï¼š</text>
              <text class="cert-value">{{item.contactPerson}}</text>
            </view>
            <view class="cert-item">
              <text class="cert-label">ğŸ“ æœåŠ¡åŒºåŸŸï¼š</text>
              <text class="cert-value">{{item.serviceArea}}</text>
            </view>
            <view class="cert-item">
              <text class="cert-label">ğŸ”§ æ“…é•¿é¢†åŸŸï¼š</text>
              <text class="cert-value">{{item.specialties}}</text>
            </view>
          </block>
          
          <!-- è®¾è®¡è€…è®¤è¯ä¿¡æ¯ -->
          <block wx:if="{{item.userType === 'designer'}}">
            <view class="cert-item">
              <text class="cert-label">ğŸ›ï¸ æ‰€å±æœºæ„ï¼š</text>
              <text class="cert-value">{{item.organization}}</text>
            </view>
            <view class="cert-item">
              <text class="cert-label">ğŸ‘” èŒç§°/èŒä½ï¼š</text>
              <text class="cert-value">{{item.title}}</text>
            </view>
            <view class="cert-item">
              <text class="cert-label">ğŸ’¡ ä¸“ä¸šé¢†åŸŸï¼š</text>
              <text class="cert-value">{{item.expertise}}</text>
            </view>
          </block>
        </view>

        <!-- çŠ¶æ€æ ‡ç­¾ -->
        <view class="status-badge {{item.status}}">
          <text wx:if="{{item.status === 'pending'}}">â³ å¾…å®¡æ ¸</text>
          <text wx:if="{{item.status === 'approved'}}">âœ… å·²é€šè¿‡</text>
          <text wx:if="{{item.status === 'rejected'}}">âŒ å·²æ‹’ç»</text>
        </view>

        <!-- æ‹’ç»åŸå›  -->
        <view class="reject-reason" wx:if="{{item.status === 'rejected' && item.rejectReason}}">
          <text class="reason-label">æ‹’ç»åŸå› ï¼š</text>
          <text class="reason-text">{{item.rejectReason}}</text>
        </view>

        <!-- å®¡æ ¸æ—¶é—´ -->
        <view class="review-time" wx:if="{{item.reviewTime}}">
          <text>å®¡æ ¸æ—¶é—´ï¼š{{item.reviewTime}}</text>
        </view>

        <!-- æ“ä½œæŒ‰é’®ï¼ˆå¾…å®¡æ ¸çŠ¶æ€ï¼‰ -->
        <view class="action-buttons" wx:if="{{item.status === 'pending'}}">
          <button 
            class="action-btn approve-btn" 
            bindtap="handleApprove"
            data-id="{{item._id}}"
            data-label="{{item.userTypeLabel}}"
          >
            âœ… é€šè¿‡
          </button>
          <button 
            class="action-btn reject-btn" 
            bindtap="handleReject"
            data-id="{{item._id}}"
          >
            âŒ æ‹’ç»
          </button>
        </view>

        <!-- æ“ä½œæŒ‰é’®ï¼ˆå·²é€šè¿‡çŠ¶æ€ - å¯ç§»é™¤ï¼‰ -->
        <view class="action-buttons" wx:if="{{item.status === 'approved'}}">
          <button 
            class="action-btn remove-btn" 
            bindtap="handleRemove"
            data-openid="{{item.openid}}"
            data-name="{{item.nickName}}"
            data-label="{{item.userTypeLabel}}"
          >
            ğŸ—‘ï¸ ç§»é™¤{{item.userTypeLabel}}èº«ä»½
          </button>
        </view>
      </view>
    </block>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{applications.length === 0}}">
      <text class="empty-icon">ğŸ“‹</text>
      <text class="empty-text">æš‚æ— {{filterText}}</text>
    </view>
  </view>

  <!-- åŠ è½½æ›´å¤š -->
  <view class="load-more" wx:if="{{hasMore}}">
    <text class="load-text" bindtap="loadMore">åŠ è½½æ›´å¤š</text>
  </view>
</view>

<!-- æ‹’ç»åŸå› å¼¹çª— -->
<view class="modal-mask" wx:if="{{showRejectModal}}" bindtap="closeRejectModal">
  <view class="modal-content" catchtap="stopPropagation">
    <view class="modal-header">
      <text class="modal-title">è¯·è¾“å…¥æ‹’ç»åŸå› </text>
    </view>
    <view class="modal-body">
      <textarea 
        class="reject-textarea"
        placeholder="è¯·è¯´æ˜æ‹’ç»åŸå› ï¼Œä»¥ä¾¿ç”³è¯·äººäº†è§£æƒ…å†µ"
        value="{{rejectReason}}"
        bindinput="onRejectReasonInput"
        maxlength="200"
      />
      <text class="char-count">{{rejectReason.length}}/200</text>
    </view>
    <view class="modal-footer">
      <button class="modal-btn cancel-btn" bindtap="closeRejectModal">å–æ¶ˆ</button>
      <button class="modal-btn confirm-btn" bindtap="confirmReject">ç¡®è®¤æ‹’ç»</button>
    </view>
  </view>
</view>

