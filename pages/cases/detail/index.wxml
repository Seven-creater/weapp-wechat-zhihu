<!-- pages/cases/detail/index.wxml -->
<view class="container" wx:if="{{!loading && caseData}}">
  <view class="header">
    <view class="header-badge" wx:if="{{caseData.isFeatured}}">
      <text class="badge-icon">â­</text>
      <text class="badge-text">ç²¾é€‰æ¡ˆä¾‹</text>
    </view>
    <view class="header-title">{{caseData.title}}</view>
    <view class="header-meta">
      <text class="meta-item">{{caseData.category}}</text>
      <text class="meta-divider">Â·</text>
      <text class="meta-item">å·¥æœŸ {{caseData.duration}} å¤©</text>
      <text class="meta-divider">Â·</text>
      <text class="meta-item">{{caseData.completedDate}}</text>
    </view>
  </view>

  <view class="info-section">
    <view class="section-title">é¡¹ç›®ä¿¡æ¯</view>
    <view class="info-grid">
      <view class="info-item">
        <text class="info-label">é¢„ç®—é‡‘é¢</text>
        <text class="info-value">Â¥{{caseData.budget}}</text>
      </view>
      <view class="info-item">
        <text class="info-label">å®é™…è´¹ç”¨</text>
        <text class="info-value">Â¥{{caseData.actualCost}}</text>
      </view>
      <view class="info-item">
        <text class="info-label">å·¥ç¨‹ç±»å‹</text>
        <text class="info-value">{{caseData.category}}</text>
      </view>
      <view class="info-item">
        <text class="info-label">æ–½å·¥å·¥æœŸ</text>
        <text class="info-value">{{caseData.duration}}å¤©</text>
      </view>
    </view>
  </view>

  <view class="nodes-section">
    <view class="section-title">æ–½å·¥è¿‡ç¨‹</view>
    <block wx:for="{{caseData.nodes}}" wx:key="index">
      <view class="node-card">
        <view class="node-header">
          <view class="node-name">{{item.name}}</view>
          <view class="node-date">{{item.completedAt}}</view>
        </view>
        
        <view class="node-images" wx:if="{{item.images && item.images.length > 0}}">
          <block wx:for="{{item.images}}" wx:for-item="img" wx:key="*this">
            <image 
              class="node-image" 
              src="{{img}}" 
              mode="aspectFill"
              bindtap="previewImage"
              data-src="{{img}}"
              data-urls="{{item.images}}"
            />
          </block>
        </view>

        <view class="node-desc" wx:if="{{item.description}}">
          {{item.description}}
        </view>

        <view class="node-cost" wx:if="{{item.actualCost}}">
          <text class="cost-label">å®é™…è´¹ç”¨ï¼š</text>
          <text class="cost-value">Â¥{{item.actualCost}}</text>
        </view>
      </view>
    </block>
  </view>

  <view class="contractor-section">
    <view class="section-title">æ‰¿åŒ…å•†ä¿¡æ¯</view>
    <view class="contractor-card" bindtap="viewContractor">
      <image class="contractor-avatar" src="{{caseData.contractorAvatar}}" />
      <view class="contractor-info">
        <view class="contractor-name">{{caseData.contractorName}}</view>
        <view class="contractor-stats">
          <text class="stat-item">å®Œæˆé¡¹ç›® {{caseData.contractorProjects || 0}}</text>
          <text class="stat-divider">Â·</text>
          <text class="stat-item">å¥½è¯„ç‡ {{caseData.contractorRating || 0}}%</text>
        </view>
      </view>
      <view class="contractor-arrow">â€º</view>
    </view>
  </view>

  <view class="action-section">
    <button class="contact-btn" bindtap="contactContractor">
      <text class="btn-icon">ğŸ’¬</text>
      <text class="btn-text">è”ç³»æ‰¿åŒ…å•†</text>
    </button>
  </view>
</view>

<view wx:if="{{loading}}" class="loading">
  <text>åŠ è½½ä¸­...</text>
</view>
