<view class="solution-detail-container">
  <!-- 封面图 Hero Section -->
  <view class="hero-section">
    <image class="hero-image" src="{{solution.beforeImg}}" mode="aspectFill" bindtap="previewImage" data-src="{{solution.beforeImg}}"></image>
    <view class="hero-overlay"></view>
    <view class="hero-content">
      <view class="hero-tags">
        <text class="hero-tag category">{{solution.category}}</text>
        <text class="hero-tag status {{solution.status === '已解决' ? 'solved' : 'processing'}}">{{solution.status}}</text>
      </view>
      <text class="hero-title">{{solution.title}}</text>
    </view>
  </view>

  <!-- 内容区域 -->
  <view class="content-section">
    <!-- AI 诊断报告 -->
    <view class="ai-analysis-card">
      <view class="ai-header">
        <image class="ai-icon" src="/images/ai.png" aria-hidden="true"></image>
        <text class="ai-title">AI 智能分析</text>
      </view>
      <view class="ai-content">
        <text class="ai-text" user-select="true">{{solution.aiAnalysis}}</text>
      </view>
    </view>

    <!-- 改造后效果（可选） -->
    <view class="after-section" wx:if="{{solution.afterImg}}">
      <view class="section-header">
        <text class="section-title">改造后效果</text>
      </view>
      <view class="after-image-wrapper">
        <image class="after-image" src="{{solution.afterImg}}" mode="aspectFill" bindtap="previewImage" data-src="{{solution.afterImg}}"></image>
      </view>
    </view>

    <!-- 官方回复（可选） -->
    <view class="official-reply-section" wx:if="{{solution.officialReply}}">
      <view class="section-header">
        <text class="section-title">官方回复</text>
      </view>
      <view class="reply-card">
        <text class="reply-text">{{solution.officialReply}}</text>
      </view>
    </view>
  </view>

  <!-- 底部操作栏 -->
  <view class="action-bar">
    <view 
      class="action-btn collect-btn {{isCollected ? 'collected' : ''}}" 
      bindtap="toggleCollect" 
      aria-role="button"
      aria-label="{{isCollected ? '取消收藏' : '收藏'}}，当前{{collectCount}}人收藏"
    >
      <image 
        src="{{isCollected ? '/images/star2.png' : '/images/star.png'}}" 
        class="btn-icon" 
        aria-hidden="true"
      ></image>
      <text class="btn-text">{{collectCount}}</text>
    </view>
    <view class="action-btn copy-btn" bindtap="copySolutionText" aria-role="button" aria-label="复制方案文本">
      <image src="/images/copy.png" class="btn-icon" aria-hidden="true"></image>
      <text class="btn-text">复制方案</text>
    </view>
    <view class="action-btn generate-btn" bindtap="generateFeedbackLetter" aria-role="button" aria-label="生成致书记的一封信">
      <image src="/images/letter.png" class="btn-icon" aria-hidden="true"></image>
      <text class="btn-text">生成公文</text>
    </view>
  </view>

  <!-- 反馈函模态框 -->
  <view class="modal {{showModal ? 'show' : ''}}" wx:if="{{showModal}}">
    <view class="modal-mask" bindtap="hideModal"></view>
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">无障碍设施整改反馈函</text>
        <view class="modal-close" bindtap="hideModal">×</view>
      </view>
      <view class="modal-body">
        <view class="letter-content">
          <text class="letter-text">{{feedbackLetter}}</text>
        </view>
      </view>
      <view class="modal-footer">
        <button class="modal-btn copy-letter-btn" bindtap="copyLetterText" aria-label="复制反馈函">复制反馈函</button>
        <button class="modal-btn close-btn" bindtap="hideModal" aria-label="关闭">关闭</button>
      </view>
    </view>
  </view>
</view>
