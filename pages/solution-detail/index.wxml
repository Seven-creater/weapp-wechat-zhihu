<view class="solution-detail-container">
  <!-- 问题现场图片 -->
  <view class="problem-section">
    <view class="section-title">问题现场</view>
    <view class="problem-image">
      <image src="{{solution.beforeImg}}" mode="widthFix" bindtap="previewImage" data-src="{{solution.beforeImg}}"></image>
    </view>
    <view class="problem-description">
      <text class="title">{{solution.title}}</text>
      <view class="meta-info">
        <text class="category">{{solution.category}}</text>
        <text class="status {{solution.status === '已解决' ? 'solved' : 'processing'}}">{{solution.status}}</text>
      </view>
    </view>
  </view>

  <!-- AI 诊断报告 -->
  <view class="ai-analysis-section">
    <view class="section-title">
      AI 诊断报告
      <text class="section-subtitle">AI 智能分析，专业整改建议</text>
    </view>
    <view class="analysis-content">
      <text class="analysis-text" user-select="true">{{solution.aiAnalysis}}</text>
      <view class="copy-tip">长按文本可复制</view>
    </view>
  </view>

  <!-- 改造后效果（可选） -->
  <view class="after-section" wx:if="{{solution.afterImg}}">
    <view class="section-title">改造后效果</view>
    <view class="after-image">
      <image src="{{solution.afterImg}}" mode="widthFix" bindtap="previewImage" data-src="{{solution.afterImg}}"></image>
    </view>
  </view>

  <!-- 官方回复（可选） -->
  <view class="official-reply-section" wx:if="{{solution.officialReply}}">
    <view class="section-title">官方回复</view>
    <view class="reply-content">
      <text class="reply-text">{{solution.officialReply}}</text>
    </view>
  </view>

  <!-- 底部操作栏 -->
  <view class="action-bar">
    <view 
      class="action-btn collect-btn {{isCollected ? 'collected' : ''}}" 
      bindtap="toggleCollect" 
      aria-role="button"
      aria-label="{{isCollected ? '取消收藏' : '收藏'}}，当前{{collectCount}}人收藏"
    >
      <image 
        src="{{isCollected ? '/images/star2.png' : '/images/star.png'}}" 
        class="btn-icon" 
        aria-hidden="true"
      ></image>
      <text>{{collectCount}}</text>
    </view>
    <view class="action-btn copy-btn" bindtap="copySolutionText" aria-role="button" aria-label="复制方案文本">
      <image src="/images/copy.png" class="btn-icon" aria-hidden="true"></image>
      <text>复制方案文本</text>
    </view>
    <view class="action-btn generate-btn" bindtap="generateFeedbackLetter" aria-role="button" aria-label="生成致书记的一封信">
      <image src="/images/letter.png" class="btn-icon" aria-hidden="true"></image>
      <text>生成致书记的一封信</text>
    </view>
  </view>

  <!-- 反馈函模态框 -->
  <view class="modal {{showModal ? 'show' : ''}}" wx:if="{{showModal}}">
    <view class="modal-mask" bindtap="hideModal"></view>
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">无障碍设施整改反馈函</text>
        <view class="modal-close" bindtap="hideModal">×</view>
      </view>
      <view class="modal-body">
        <view class="letter-content">
          <text class="letter-text">{{feedbackLetter}}</text>
        </view>
      </view>
      <view class="modal-footer">
        <button class="modal-btn copy-letter-btn" bindtap="copyLetterText" aria-label="复制反馈函">复制反馈函</button>
        <button class="modal-btn close-btn" bindtap="hideModal" aria-label="关闭">关闭</button>
      </view>
    </view>
  </view>
</view>