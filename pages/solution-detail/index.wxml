<view class="page-container">
  <!-- 1. é¡¶éƒ¨å¤§å›¾åŒº -->
  <view class="hero-section">
    <image class="hero-img" src="{{solution.beforeImg}}" mode="aspectFill" bindtap="previewImage" data-src="{{solution.beforeImg}}"></image>
    <view class="status-tag">{{solution.status || 'AI åˆ†æå®Œæˆ'}}</view>
  </view>

  <!-- 2. é—®é¢˜æè¿°å¡ç‰‡ (æ–°å¢) -->
  <view class="description-card" wx:if="{{solution.description}}">
    <view class="card-header">
      <view class="red-line"></view>
      <text class="section-title">ğŸ“¸ é—®é¢˜æè¿°</text>
    </view>
    <view class="description-content">
      <text user-select="true">{{solution.description}}</text>
    </view>
  </view>

  <!-- 3. AI æ™ºèƒ½åˆ†ææŠ¥å‘Šå¡ç‰‡ -->
  <view class="content-card">
    <view class="card-header">
      <view class="blue-line"></view>
      <text class="section-title">ğŸ¤– AI æ™ºèƒ½åˆ†ææŠ¥å‘Š</text>
      <view 
        class="voice-play-btn {{isPlaying ? 'playing' : ''}}"
        bindtap="toggleVoicePlay"
        aria-role="button"
        aria-label="{{isPlaying ? 'åœæ­¢æœ—è¯»' : 'æœ—è¯»AIåˆ†æ'}}"
      >
        <text class="voice-icon">{{isPlaying ? 'ğŸ”Š' : 'ğŸ“¢'}}</text>
      </view>
    </view>
    
    <view class="report-box">
      <text class="report-text" user-select="true">{{solution.aiAnalysis}}</text>
    </view>

    <view class="info-row">
      <text class="label">ğŸ“ é—®é¢˜åœ°ç‚¹ï¼š</text>
      <text class="value">{{solution.address || 'æœªçŸ¥åœ°ç‚¹'}}</text>
    </view>

    <view class="user-suggestion-card" wx:if="{{solution.userSuggestion && solution.userSuggestion.length > 0}}">
      <view class="suggestion-header">
        <text class="suggestion-icon">ğŸ‘¤</text>
        <text class="suggestion-title">æˆ‘çš„å»ºè®®</text>
      </view>
      <view class="suggestion-content">
        <text class="suggestion-text" user-select="true">{{solution.userSuggestion}}</text>
      </view>
    </view>
  </view>

  <view class="case-detail-container" wx:if="{{solution.plan}}">
    <view class="header">
      <text class="title">{{solution.plan.schemeName || 'æ”¹é€ æ–¹æ¡ˆ'}}</text>
      <text class="description">{{solution.plan.planDesc || ''}}</text>
    </view>

    <view class="images">
      <image class="image" src="{{solution.beforeImg}}" mode="aspectFill" />
      <text class="label">æ”¹é€ å‰</text>
      <image class="image" src="{{solution.afterImg || '/images/24280.jpg'}}" mode="aspectFill" />
      <text class="label">æ”¹é€ å</text>
    </view>

    <view class="budget">
      <text>é¢„ç®—ï¼šÂ¥{{solution.plan.totalCost || '--'}}</text>
    </view>

    <view class="steps" wx:if="{{solution.plan.steps && solution.plan.steps.length}}">
      <text class="steps-title">æ”¹é€ æ­¥éª¤ï¼š</text>
      <block wx:for="{{solution.plan.steps}}" wx:key="index">
        <text class="step">{{index + 1}}. {{item}}</text>
      </block>
    </view>
  </view>

  <!-- 5. åº•éƒ¨å›ºå®šæ  -->
  <view class="bottom-bar">
    <!-- å·¦ä¾§ï¼šæ”¶è—æŒ‰é’® -->
    <view class="action-btn" bindtap="toggleCollect" aria-role="button" aria-label="{{isCollected ? 'å–æ¶ˆæ”¶è—' : 'æ”¶è—'}}">
      <text class="icon">{{isCollected ? 'â˜…' : 'â˜†'}}</text>
      <text class="btn-text">{{isCollected ? 'å·²æ”¶è—' : 'æ”¶è—'}}</text>
    </view>

    <view class="main-btn" bindtap="goToConstruction" aria-role="button" aria-label="æ–½å·¥æœåŠ¡å¯¹æ¥" wx:if="{{solution.plan && solution.status !== 'å·²å®Œæˆ'}}">
      <text>æ–½å·¥æœåŠ¡å¯¹æ¥</text>
    </view>
    <view class="main-btn" bindtap="generateDoc" aria-role="button" aria-label="ç”Ÿæˆä¸“ä¸šæ±‡æŠ¥ææ–™" wx:else>
      <text>ç”Ÿæˆä¸“ä¸šæ±‡æŠ¥ææ–™</text>
    </view>
  </view>
</view>
