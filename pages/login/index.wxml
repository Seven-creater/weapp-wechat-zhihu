<!--pages/login/index.wxml-->
<view class="container">
  <view class="content">
    <!-- 标题 -->
    <view class="title">欢迎来到無界营造</view>
    <view class="subtitle">让无障碍环境更美好</view>

    <!-- 🆕 身份选择 -->
    <view class="identity-section">
      <text class="section-label">请选择您的身份</text>
      <view class="identity-list">
        <view 
          wx:for="{{userTypes}}" 
          wx:key="id"
          class="identity-item {{selectedType === item.id ? 'selected' : ''}}"
          bindtap="selectType"
          data-type="{{item.id}}"
        >
          <view class="identity-header">
            <text class="badge-icon">{{item.badge.icon}}</text>
            <text class="identity-label">{{item.label}}</text>
            <text class="check-icon" wx:if="{{selectedType === item.id}}">✓</text>
          </view>
          <text class="identity-desc">{{item.description}}</text>
        </view>
      </view>
    </view>

    <!-- 头像选择 -->
    <view class="avatar-section">
      <text class="label">头像</text>
      <button 
        class="avatar-wrapper" 
        open-type="chooseAvatar" 
        bindchooseavatar="onChooseAvatar"
      >
        <image class="avatar" src="{{avatarUrl}}" mode="aspectFill"></image>
        <view class="avatar-mask">
          <text class="avatar-text">点击更换</text>
        </view>
      </button>
      <text class="hint">点击头像选择照片</text>
    </view>

    <!-- 昵称输入 -->
    <view class="nickname-section">
      <text class="label">昵称 <text class="required">*</text></text>
      <input 
        class="nickname-input" 
        type="nickname" 
        placeholder="请输入昵称"
        value="{{nickName}}"
        bindinput="onNicknameInput"
        maxlength="20"
      />
      <text class="hint">2-20个字符</text>
    </view>

    <!-- 手机号输入 -->
    <view class="phone-section">
      <text class="label">手机号 <text class="required">*</text></text>
      <input 
        class="phone-input" 
        type="number" 
        placeholder="请输入11位手机号"
        value="{{phoneNumber}}"
        bindinput="onPhoneInput"
        maxlength="11"
      />
      <text class="hint">用于后台联系，不会公开显示</text>
    </view>

    <!-- 🆕 补充信息（可选） -->
    <view class="optional-section" wx:if="{{showProfileFields}}">
      <text class="section-label">补充信息</text>
      
      <view class="form-item">
        <text class="label">个人简介 {{selectedType === 'communityWorker' ? '' : '（可选）'}}</text>
        <textarea 
          class="textarea-input" 
          placeholder="简单介绍一下自己..."
          value="{{bio}}"
          bindinput="onBioInput"
          maxlength="200"
        ></textarea>
      </view>

      <!-- 🔧 社区工作者和施工方必须填写认证信息 -->
      <view wx:if="{{selectedType === 'communityWorker' || selectedType === 'contractor'}}">
        <view 
          wx:for="{{selectedTypeConfig.profileFields}}" 
          wx:key="key"
          class="form-item"
        >
          <text class="label">{{item.label}} <text class="required" wx:if="{{item.required}}">*</text></text>
          <input 
            class="text-input" 
            placeholder="{{item.placeholder}}"
            bindinput="onCustomFieldInput"
            data-key="{{item.key}}"
            value="{{customFields[item.key]}}"
          />
        </view>
      </view>
    </view>

    <!-- 提示信息 -->
    <view class="tips-inline" wx:if="{{selectedType === 'communityWorker'}}">
      <text class="tip-icon">⚠️</text>
      <text class="tip-text">社区工作者需要填写认证信息以验证身份</text>
    </view>
    <view class="tips-inline" wx:if="{{selectedType === 'contractor'}}">
      <text class="tip-icon">⚠️</text>
      <text class="tip-text">施工方需要填写认证信息以验证身份</text>
    </view>

    <!-- 提交按钮 -->
    <button 
      class="submit-btn {{canSubmit ? 'active' : ''}}" 
      bindtap="submitUserInfo"
      disabled="{{!canSubmit}}"
    >
      完成
    </button>

    <!-- 跳过按钮（已禁用） -->
    <view class="skip-btn disabled" bindtap="skipLogin">
      <text>手机号为必填项</text>
    </view>
  </view>

  <!-- 说明 -->
  <view class="tips">
    <text class="tips-title">温馨提示</text>
    <text class="tips-item">• 身份可随时在"我的-设置"中修改</text>
    <text class="tips-item">• 头像和昵称将展示给其他用户</text>
    <text class="tips-item">• 手机号仅用于后台联系，不会公开</text>
    <text class="tips-item">• 不同身份拥有不同的功能权限</text>
  </view>
</view>
