<!--pages/project/manage/index.wxml-->
<view class="container">
  <!-- æ ‡ç­¾åˆ‡æ¢ -->
  <view class="tabs">
    <view 
      class="tab-item {{activeTab === 'active' ? 'active' : ''}}"
      bindtap="switchTab"
      data-tab="active"
    >
      <text class="tab-text">è¿›è¡Œä¸­</text>
    </view>
    <view 
      class="tab-item {{activeTab === 'completed' ? 'active' : ''}}"
      bindtap="switchTab"
      data-tab="completed"
    >
      <text class="tab-text">å·²å®Œæˆ</text>
    </view>
  </view>

  <!-- é¡¹ç›®åˆ—è¡¨ -->
  <view class="projects-list">
    <view 
      wx:for="{{projects}}" 
      wx:key="_id"
      class="project-card"
      bindtap="viewProject"
      data-id="{{item._id}}"
    >
      <view class="project-header">
        <text class="project-title">{{item.title}}</text>
        <view class="category-badge">{{item.category}}</view>
      </view>
      
      <view class="project-info">
        <text class="info-item">ğŸ“ {{item.address}}</text>
        <text class="info-item">ğŸ’° å®é™…æ¶ˆè€—: Â¥{{item.actualCost || 0}}</text>
      </view>

      <view class="project-progress">
        <view class="progress-header">
          <text class="progress-label">å½“å‰è¿›åº¦</text>
          <text class="progress-percent">{{getProgress(item.currentNode)}}%</text>
        </view>
        <view class="progress-bar">
          <view 
            class="progress-fill" 
            style="width: {{getProgress(item.currentNode)}}%"
          ></view>
        </view>
        <text class="progress-node">{{item.nodes[item.currentNode].name}}</text>
      </view>
      
      <view class="project-footer">
        <text class="project-time">{{formatTime(item.createTime)}}</text>
        <view 
          wx:if="{{activeTab === 'active'}}"
          class="update-btn"
          catchtap="updateProgress"
          data-id="{{item._id}}"
          data-node="{{item.currentNode}}"
        >
          æ›´æ–°è¿›åº¦
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view wx:if="{{!loading && projects.length === 0}}" class="empty">
      <image class="empty-icon" src="/images/empty.png" mode="aspectFit" />
      <text class="empty-text">{{activeTab === 'active' ? 'æš‚æ— è¿›è¡Œä¸­çš„é¡¹ç›®' : 'æš‚æ— å·²å®Œæˆçš„é¡¹ç›®'}}</text>
    </view>

    <!-- åŠ è½½çŠ¶æ€ -->
    <view wx:if="{{loading}}" class="loading">
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>
  </view>
</view>



