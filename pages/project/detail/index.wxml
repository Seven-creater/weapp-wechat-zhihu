<!--pages/project/detail/index.wxml-->
<view class="container">
  <view wx:if="{{project}}">
    <!-- é¡¹ç›®ä¿¡æ¯ -->
    <view class="project-header">
      <view class="header-title">{{project.title}}</view>
      <view class="header-badge">{{project.category}}</view>
    </view>

    <view class="project-info">
      <text class="info-item">ğŸ“ {{project.formattedAddress || project.address}}</text>
      <text class="info-item">ğŸ’° å®é™…æ¶ˆè€—: Â¥{{project.actualCost || 0}}</text>
      <text class="info-item">ğŸ“ {{project.contactPhone}}</text>
    </view>

    <!-- æ–½å·¥æ–¹ä¿¡æ¯å¡ç‰‡ -->
    <view class="contractor-card" bindtap="navigateToContractor">
      <image 
        class="contractor-avatar" 
        src="{{project.contractorAvatar || '/images/zhi.png'}}" 
        mode="aspectFill"
      ></image>
      <view class="contractor-info">
        <text class="contractor-name">{{project.contractorName || 'æ–½å·¥æ–¹'}}</text>
        <view class="contractor-badge">
          <text class="badge-icon">ğŸ—ï¸</text>
          <text class="badge-text">æ–½å·¥æ–¹</text>
        </view>
      </view>
      <text class="arrow-icon">â€º</text>
    </view>

    <!-- èŠ‚ç‚¹è¿›åº¦ -->
    <view class="nodes-section">
      <view class="section-title">æ–½å·¥è¿›åº¦</view>
      <view class="nodes-timeline">
        <view 
          wx:for="{{project.stages}}" 
          wx:key="index"
          class="node-item {{item.status}}"
        >
          <view class="node-left">
            <view class="node-dot {{item.status}}"></view>
            <view wx:if="{{index < project.stages.length - 1}}" class="node-line {{item.status}}"></view>
          </view>
          
          <view class="node-content">
            <view class="node-header">
              <text class="node-name">{{item.name}}</text>
              <text class="node-status">{{item.status === 'completed' ? 'å·²å®Œæˆ' : 'å¾…å®Œæˆ'}}</text>
            </view>
            
            <view wx:if="{{item.status === 'completed'}}">
              <view wx:if="{{item.images && item.images.length > 0}}" class="node-images">
                <image 
                  wx:for="{{item.images}}" 
                  wx:for-item="img"
                  wx:key="index"
                  class="node-image"
                  src="{{img}}" 
                  mode="aspectFill"
                  bindtap="previewImage"
                  data-src="{{img}}"
                  data-images="{{item.images}}"
                />
              </view>
              <view wx:if="{{item.description}}" class="node-desc">{{item.description}}</view>
              <view wx:if="{{item.completedAt}}" class="node-time">å®Œæˆæ—¶é—´: {{item.completedAtFormatted}}</view>
              <view wx:if="{{item.actualCost}}" class="node-cost">è´¹ç”¨: Â¥{{item.actualCost}}</view>
            </view>
            
            <view wx:elif="{{item.status === 'in_progress'}}" class="node-action">
              <button 
                class="update-node-btn"
                bindtap="updateNode"
                data-index="{{index}}"
              >
                æ›´æ–°æ­¤èŠ‚ç‚¹
              </button>
            </view>
            
            <view wx:else class="node-action">
              <text class="node-pending-text">å¾…å®Œæˆ</text>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <view wx:if="{{loading}}" class="loading">åŠ è½½ä¸­...</view>
</view>



