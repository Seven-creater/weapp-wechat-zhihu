<view class="mine-container">
  <!-- æœªç™»å½•çŠ¶æ€ -->
  <view class="header-section" wx:if="{{!isLoggedIn}}">
    <view class="login-prompt" bindtap="handleLogin">
      <image class="avatar" src="/images/zhi.png" mode="aspectFill" />
      <view class="login-text">
        <text class="login-title">ç‚¹å‡»ç™»å½•</text>
        <text class="login-subtitle">ç™»å½•åæŸ¥çœ‹æ›´å¤šå†…å®¹</text>
      </view>
    </view>
  </view>

  <!-- å·²ç™»å½•çŠ¶æ€ -->
  <view class="header-section" wx:else>
    <!-- å·¦ä¾§ï¼šå¤´åƒ -->
    <view class="avatar-button" bindtap="navigateToEditProfile">
      <image 
        class="avatar" 
        src="{{userInfo.avatarUrl || '/images/zhi.png'}}" 
        mode="aspectFill"
        binderror="onAvatarError"
      />
      <view class="avatar-edit-tip">ç‚¹å‡»ç¼–è¾‘</view>
    </view>

    <!-- ä¸­é—´ï¼šç”¨æˆ·ä¿¡æ¯ -->
    <view class="user-details">
      <!-- æ˜µç§°å’Œå¾½ç«  -->
      <view class="name-badge-row">
        <text class="nickname-text">{{userInfo.nickName || 'ç„¡ç•Œç”¨æˆ·'}}</text>
        <!-- èº«ä»½å¾½ç«  -->
        <view 
          class="badge" 
          style="background-color: {{userInfo.badge.color}}20; border-color: {{userInfo.badge.color}}"
          wx:if="{{userInfo.badge}}"
        >
          <text class="badge-icon">{{userInfo.badge.icon}}</text>
          <text class="badge-text" style="color: {{userInfo.badge.color}}">{{userInfo.badge.text}}</text>
        </view>
      </view>
      
      <!-- ä¸ªäººç®€ä»‹ -->
      <text class="user-bio" wx:if="{{userInfo.profile && userInfo.profile.bio}}">{{userInfo.profile.bio}}</text>
      
      <!-- ğŸ”§ ç¤¾åŒºå·¥ä½œè€…è®¤è¯ä¿¡æ¯ -->
      <view class="user-extra-grid" wx:if="{{userInfo.userType === 'communityWorker'}}">
        <view class="extra-item" wx:if="{{userInfo.profile && userInfo.profile.community}}">
          <text class="extra-icon">ğŸ˜ï¸</text>
          <text class="extra-text">{{userInfo.profile.community}}</text>
        </view>
        <view class="extra-item" wx:if="{{userInfo.profile && userInfo.profile.position}}">
          <text class="extra-icon">ğŸ‘”</text>
          <text class="extra-text">{{userInfo.profile.position}}</text>
        </view>
        <view class="extra-item" wx:if="{{userInfo.profile && userInfo.profile.workId}}">
          <text class="extra-icon">ğŸ†”</text>
          <text class="extra-text">{{userInfo.profile.workId}}</text>
        </view>
        <view class="extra-item phone-item" wx:if="{{userInfo.phoneNumber}}" bindtap="makePhoneCall" data-phone="{{userInfo.phoneNumber}}">
          <text class="extra-icon">ğŸ“</text>
          <text class="extra-text phone-link">{{userInfo.phoneNumber}}</text>
        </view>
      </view>
      
      <!-- ğŸ†• æ–½å·¥æ–¹è®¤è¯ä¿¡æ¯ -->
      <view class="user-extra-grid" wx:if="{{userInfo.userType === 'contractor'}}">
        <view class="extra-item" wx:if="{{userInfo.profile && userInfo.profile.companyName}}">
          <text class="extra-icon">ğŸ¢</text>
          <text class="extra-text">{{userInfo.profile.companyName}}</text>
        </view>
        <view class="extra-item" wx:if="{{userInfo.profile && userInfo.profile.contactPerson}}">
          <text class="extra-icon">ğŸ‘¤</text>
          <text class="extra-text">{{userInfo.profile.contactPerson}}</text>
        </view>
        <view class="extra-item" wx:if="{{userInfo.profile && userInfo.profile.serviceArea}}">
          <text class="extra-icon">ğŸ“</text>
          <text class="extra-text">{{userInfo.profile.serviceArea}}</text>
        </view>
        <view class="extra-item phone-item" wx:if="{{userInfo.phoneNumber}}" bindtap="makePhoneCall" data-phone="{{userInfo.phoneNumber}}">
          <text class="extra-icon">ğŸ“</text>
          <text class="extra-text phone-link">{{userInfo.phoneNumber}}</text>
        </view>
      </view>
      
      <!-- ğŸ†• è®¤è¯çŠ¶æ€æç¤º -->
      <view class="cert-status-tip" wx:if="{{userInfo.profile && userInfo.profile.certificationStatus === 'pending'}}">
        <text class="cert-status-icon">â³</text>
        <text class="cert-status-text">ç¤¾åŒºå·¥ä½œè€…è®¤è¯å®¡æ ¸ä¸­ï¼Œè¯·è€å¿ƒç­‰å¾…...</text>
      </view>
    </view>

    <!-- å³ä¾§ï¼šæ“ä½œæŒ‰é’® -->
    <view class="action-buttons-right">
      <!-- ğŸ” ç®¡ç†å‘˜å…¥å£ -->
      <button class="action-btn-right admin-btn" bindtap="navigateToAdminCertification" wx:if="{{isAdmin}}">
        ğŸ” è®¤è¯å®¡æ ¸
      </button>
      <button class="action-btn-right logout-btn" bindtap="handleLogout">é€€å‡ºç™»å½•</button>
    </view>
  </view>

  <!-- Stats Section -->
  <view class="stats-section" wx:if="{{isLoggedIn}}">
    <view class="stat-item" bindtap="navigateToFollowList" data-type="following">
      <text class="stat-num">{{stats.following}}</text>
      <text class="stat-label">å…³æ³¨</text>
    </view>
    <view class="stat-item" bindtap="navigateToFollowList" data-type="followers">
      <text class="stat-num">{{stats.followers}}</text>
      <text class="stat-label">ç²‰ä¸</text>
    </view>
    <view class="stat-item">
      <text class="stat-num">{{stats.likes}}</text>
      <text class="stat-label">è·èµ</text>
    </view>
  </view>

  <!-- Tabs Section -->
  <view class="tabs-section" wx:if="{{isLoggedIn}}">
    <view class="tab-item {{currentTab === 0 ? 'active' : ''}}" bindtap="onTabTap" data-index="{{0}}">ç¬”è®°</view>
    <view class="tab-item {{currentTab === 1 ? 'active' : ''}}" bindtap="onTabTap" data-index="{{1}}">æ”¶è—</view>
    <view class="tab-item {{currentTab === 2 ? 'active' : ''}}" bindtap="onTabTap" data-index="{{2}}">èµè¿‡</view>
  </view>

  <!-- Content Grid -->
  <view class="content-grid" wx:if="{{isLoggedIn}}">
    <block wx:for="{{posts}}" wx:key="id">
      <view class="grid-item" bindtap="navigateToDetail" data-id="{{item.id}}" data-route="{{item.route}}">
        <image class="post-img" src="{{item.image}}" mode="aspectFill" wx:if="{{item.hasImage}}" />
        <view class="post-title">{{item.title}}</view>
        <view class="post-likes">â¤ï¸ {{item.likes}}</view>
      </view>
    </block>
    
    <view class="empty-state" wx:if="{{posts.length === 0}}">
      <image class="empty-img" src="/images/empty.png" mode="aspectFit" />
      <text class="empty-text">{{emptyText}}</text>
    </view>
  </view>

  <!-- Loading Footer -->
  <view class="list-footer" wx:if="{{loading && isLoggedIn}}">
    <text class="footer-text">åŠ è½½ä¸­...</text>
  </view>
  <view class="list-footer" wx:if="{{!loading && !hasMore && posts.length > 0 && isLoggedIn}}">
    <text class="footer-text">æ²¡æœ‰æ›´å¤šäº†</text>
  </view>
</view>
