<view class="community-container">
  <!-- 页面头部 -->
  <view class="header">
    <text class="title" aria-label="无障碍社区">社区</text>
    <view class="header-right">
      <view class="icon-btn" bindtap="refreshPosts" aria-role="button" aria-label="刷新社区内容">
        <image class="icon" src="/images/refresh.png" aria-hidden="true"></image>
      </view>
      <view class="icon-btn" aria-role="button" aria-label="搜索社区内容">
        <image class="icon" src="/images/search.png" aria-hidden="true"></image>
      </view>
    </view>
  </view>

  <!-- 帖子列表 -->
  <view class="post-list">
    <view 
      class="post-item" 
      wx:for="{{posts}}" 
      wx:key="_id" 
      bindtap="goToDetail" 
      data-postid="{{item._id}}"
      aria-role="button"
      aria-label="查看{{item.userInfo.nickName}}的帖子：{{item.content.substring(0, 50)}}..."
    >
      <!-- 帖子头部：用户信息 -->
      <view class="post-header">
        <image class="avatar" src="{{item.userInfo.avatarUrl}}" aria-hidden="true"></image>
        <view class="user-info">
          <text class="user-name">{{item.userInfo.nickName}}</text>
          <text class="post-time">{{item.createTime}}</text>
        </view>
        <view class="post-type" wx:if="{{item.type}}">
          <text class="type-tag type-{{item.type}}">
            {{item.type === 'help' ? '求助' : item.type === 'share' ? '分享' : '路障反馈'}}
          </text>
        </view>
      </view>

      <!-- 帖子内容 -->
      <view class="post-content">
        <text class="content-text" user-select="true">{{item.content}}</text>
      </view>

      <!-- 图片展示（九宫格） -->
      <view class="post-images" wx:if="{{item.images && item.images.length > 0}}">
        <view class="image-grid">
          <image 
            class="post-image" 
            wx:for="{{item.images}}" 
            wx:key="index" 
            src="{{item}}" 
            mode="aspectFill"
            aria-label="帖子图片{{index + 1}}"
          ></image>
        </view>
      </view>

      <!-- 底部操作栏 -->
      <view class="post-actions">
        <view 
          class="action-btn like-btn {{item.liked ? 'liked' : ''}}" 
          bindtap="likePost" 
          data-postid="{{item._id}}" 
          data-index="{{index}}"
          aria-role="button"
          aria-label="{{item.liked ? '取消点赞' : '点赞'}}，当前{{item.stats.like}}个赞"
        >
          <image class="action-icon" src="/images/like{{item.liked ? '-active' : ''}}.png" aria-hidden="true"></image>
          <text class="action-text">{{item.stats.like}}</text>
        </view>

        <view 
          class="action-btn comment-btn" 
          bindtap="goToDetail" 
          data-postid="{{item._id}}"
          aria-role="button"
          aria-label="查看评论，当前{{item.stats.comment}}条评论"
        >
          <image class="action-icon" src="/images/comment.png" aria-hidden="true"></image>
          <text class="action-text">{{item.stats.comment}}</text>
        </view>

        <view 
          class="action-btn share-btn" 
          bindtap="sharePost" 
          data-postid="{{item._id}}"
          aria-role="button"
          aria-label="分享帖子"
        >
          <image class="action-icon" src="/images/share.png" aria-hidden="true"></image>
          <text class="action-text">分享</text>
        </view>

        <view 
          class="action-btn collect-btn {{item.isCollected ? 'collected' : ''}}" 
          bindtap="collectPost" 
          data-postid="{{item._id}}"
          data-index="{{index}}"
          aria-role="button"
          aria-label="{{item.isCollected ? '取消收藏' : '收藏'}}，当前{{item.collectCount || 0}}人收藏"
        >
          <image class="action-icon" src="{{item.isCollected ? '/images/star2.png' : '/images/star.png'}}" aria-hidden="true"></image>
          <text class="action-text">{{item.collectCount || 0}}</text>
        </view>

        <view class="view-stats">
          <text class="view-text">{{item.stats.view}} 浏览</text>
        </view>
      </view>
    </view>

    <!-- 加载更多提示 -->
    <view class="load-more" wx:if="{{loading}}">
      <text class="loading-text">加载中...</text>
    </view>
    <view class="load-more" wx:if="{{!hasMore && posts.length > 0}}">
      <text class="no-more-text">没有更多内容了</text>
    </view>
  </view>

  <!-- 悬浮发布按钮 (FAB) -->
  <view 
    class="fab-button" 
    bindtap="goToCreatePost"
    aria-role="button"
    aria-label="发布新帖子"
  >
    <text class="fab-icon" aria-hidden="true">+</text>
  </view>

  <!-- 空状态 -->
  <view class="empty-state" wx:if="{{posts.length === 0 && !loading}}">
    <image class="empty-icon" src="/images/empty-community.png" aria-hidden="true"></image>
    <text class="empty-text">暂无帖子内容</text>
    <text class="empty-subtext">点击下方+按钮发布第一条帖子</text>
  </view>
</view>