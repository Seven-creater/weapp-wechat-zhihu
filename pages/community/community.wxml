<view class="community-container">
  <!-- Top Navigation Tabs -->
  <view class="top-tabs">
    <view class="tab-item {{currentTab === 0 ? 'active' : ''}}" bindtap="onTabTap" data-index="{{0}}">关注</view>
    <view class="tab-item {{currentTab === 1 ? 'active' : ''}}" bindtap="onTabTap" data-index="{{1}}">社区</view>
    <view class="tab-item {{currentTab === 2 ? 'active' : ''}}" bindtap="onTabTap" data-index="{{2}}">案例</view>
  </view>

  <!-- Content Area -->
  <scroll-view scroll-y class="content-scroll" bindscrolltolower="onLoadMore">
    <view class="waterfall">
      <view class="waterfall-column">
        <block wx:for="{{leftColPosts}}" wx:key="id">
          <template is="postCard" data="{{item}}" />
        </block>
      </view>
      <view class="waterfall-column">
        <block wx:for="{{rightColPosts}}" wx:key="id">
          <template is="postCard" data="{{item}}" />
        </block>
      </view>
    </view>
    <view class="loading" wx:if="{{loading}}">加载中...</view>
    <view class="empty" wx:if="{{!loading && posts.length === 0}}">
      {{currentTab === 0 ? '暂无关注内容' : (currentTab === 2 ? '暂无案例，发布时选择“案例”即可显示' : '暂无内容')}}
    </view>
  </scroll-view>
</view>

<!-- Post Card Template -->
<template name="postCard">
  <view class="post-card" bindtap="onPostTap" data-id="{{item.id}}">
    <image class="post-image" src="{{item.image}}" mode="widthFix" />
    <view class="post-info">
      <view class="post-tag" wx:if="{{item.tag}}">{{item.tag}}</view>
      <view class="post-title">{{item.title}}</view>
      <view class="post-meta">
        <view class="user-info" catchtap="onUserTap" data-id="{{item.user.id || item.user._openid}}">
          <image class="user-avatar" src="{{item.user.avatar}}" />
          <text class="user-name">{{item.user.name}}</text>
        </view>
        <view class="like-info">
          <image class="like-icon" src="/images/heart2.png" />
          <text class="like-count">{{item.likes}}</text>
        </view>
      </view>
    </view>
  </view>
</template>
