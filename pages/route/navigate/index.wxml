<!--pages/route/navigate/index.wxml-->
<view class="container">
  <!-- åœ°å›¾ -->
  <map
    id="navMap"
    class="map-view"
    longitude="{{longitude}}"
    latitude="{{latitude}}"
    scale="{{scale}}"
    markers="{{markers}}"
    polyline="{{polyline}}"
    show-location
    enable-rotate
    enable-overlooking
  >
    <!-- é¡¶éƒ¨ä¿¡æ¯æ  -->
    <cover-view class="top-info">
      <cover-view class="info-card {{offRoute ? 'warning' : ''}}">
        <cover-view class="info-main">
          <cover-view class="distance-large">{{formatDistance(distanceToNext)}}</cover-view>
          <cover-view class="direction-text">{{direction}}æ–¹å‘</cover-view>
        </cover-view>
        <cover-view class="info-sub">
          <cover-view class="next-waypoint">
            {{route && route.waypoints[currentWaypointIndex + 1] ? route.waypoints[currentWaypointIndex + 1].name : 'ç»ˆç‚¹'}}
          </cover-view>
          <cover-view class="total-distance">å‰©ä½™ {{formatDistance(distanceToEnd)}}</cover-view>
        </cover-view>
      </cover-view>
      
      <!-- åç¦»æç¤º -->
      <cover-view wx:if="{{offRoute}}" class="off-route-alert">
        <cover-view class="alert-icon">âš ï¸</cover-view>
        <cover-view class="alert-text">æ‚¨å·²åç¦»è·¯çº¿ï¼Œè¯·è¿”å›</cover-view>
      </cover-view>
    </cover-view>

    <!-- å³ä¾§æ§åˆ¶æŒ‰é’® -->
    <cover-view class="side-controls">
      <cover-view class="control-btn" bindtap="toggleVoice">
        <cover-view class="control-icon">{{voiceEnabled ? 'ğŸ”Š' : 'ğŸ”‡'}}</cover-view>
      </cover-view>
    </cover-view>
  </map>

  <!-- åº•éƒ¨æ§åˆ¶æ  -->
  <view class="bottom-controls">
    <button wx:if="{{!navigating}}" class="nav-btn start" bindtap="startNavigation">
      <text class="btn-icon">â–¶ï¸</text>
      <text class="btn-text">å¼€å§‹å¯¼èˆª</text>
    </button>
    
    <button wx:if="{{navigating}}" class="nav-btn stop" bindtap="stopNavigation">
      <text class="btn-icon">â¹ï¸</text>
      <text class="btn-text">ç»“æŸå¯¼èˆª</text>
    </button>
  </view>

  <!-- åˆ°è¾¾æç¤º -->
  <view wx:if="{{arrived}}" class="arrival-overlay">
    <view class="arrival-card">
      <view class="arrival-icon">ğŸ‰</view>
      <view class="arrival-title">å·²åˆ°è¾¾ç›®çš„åœ°</view>
      <view class="arrival-text">æ„Ÿè°¢ä½¿ç”¨æ— éšœç¢å¯¼èˆª</view>
    </view>
  </view>
</view>

