<view class="map-container">
  <!-- åœ°å›¾ -->
  <map
    id="issueMap"
    class="map-view"
    latitude="{{latitude}}"
    longitude="{{longitude}}"
    scale="{{scale}}"
    markers="{{markers}}"
    bindmarkertap="handleMarkerTap"
    setting="{{setting}}"
  >
    <!-- é¡¶éƒ¨æ ‡é¢˜æ  -->
    <cover-view class="map-header">
      <cover-view class="header-title">
        <cover-view class="title-icon">ğŸ—ºï¸</cover-view>
        <cover-view class="title-text">é—®é¢˜åœ°å›¾</cover-view>
      </cover-view>
      <cover-view class="header-stats">
        <cover-view class="stat-item">
          <cover-view class="stat-number">{{filteredPosts.length}}</cover-view>
          <cover-view class="stat-label">ä¸ªé—®é¢˜</cover-view>
        </cover-view>
      </cover-view>
    </cover-view>

    <!-- åˆ†ç±»ç­›é€‰æŒ‰é’® -->
    <cover-view class="category-toggle-btn" bindtap="toggleCategoryPanel">
      <cover-view class="toggle-icon">ğŸ·ï¸</cover-view>
      <cover-view class="toggle-text">{{selectedCategoryName}}</cover-view>
      <cover-view class="toggle-arrow">{{showCategoryPanel ? 'â–²' : 'â–¼'}}</cover-view>
    </cover-view>

    <!-- åˆ†ç±»ç­›é€‰é¢æ¿ -->
    <cover-view class="category-panel" wx:if="{{showCategoryPanel}}">
      <cover-view class="panel-header">
        <cover-view class="panel-title">é€‰æ‹©åˆ†ç±»</cover-view>
        <cover-view class="panel-close" bindtap="toggleCategoryPanel">âœ•</cover-view>
      </cover-view>
      <cover-view class="category-grid">
        <cover-view 
          wx:for="{{categories}}" 
          wx:key="id"
          class="category-card {{selectedCategory === item.id ? 'active' : ''}}"
          data-id="{{item.id}}"
          bindtap="switchCategory"
        >
          <cover-view class="card-name">{{item.shortName}}</cover-view>
        </cover-view>
      </cover-view>
    </cover-view>



    <!-- å›¾ä¾‹è¯´æ˜ -->
    <cover-view class="map-legend">
      <cover-view class="legend-item">
        <cover-view class="legend-dot" style="background: #fef3c7;"></cover-view>
        <cover-view class="legend-text">å¾…å¤„ç†</cover-view>
      </cover-view>
      <cover-view class="legend-item">
        <cover-view class="legend-dot" style="background: #dbeafe;"></cover-view>
        <cover-view class="legend-text">å¤„ç†ä¸­</cover-view>
      </cover-view>
      <cover-view class="legend-item">
        <cover-view class="legend-dot" style="background: #d1fae5;"></cover-view>
        <cover-view class="legend-text">å·²å®Œæˆ</cover-view>
      </cover-view>
    </cover-view>

    <!-- é®æŒ¡å³ä¾§æŒ‰é’® -->
    <cover-view class="right-side-mask"></cover-view>
  </map>

  <!-- åŠ è½½æç¤º -->
  <view wx:if="{{loading}}" class="loading-overlay">
    <view class="loading-spinner"></view>
    <view class="loading-text">åŠ è½½ä¸­...</view>
  </view>
</view>
