# ç®¡ç†å‘˜æƒé™ç³»ç»Ÿè¯´æ˜

## ğŸ“‹ æ–¹æ¡ˆæ¦‚è¿°

é‡‡ç”¨**æ··åˆæ–¹æ¡ˆ**ï¼šç¡¬ç¼–ç è¶…çº§ç®¡ç†å‘˜ + æ•°æ®åº“åŠ¨æ€ç®¡ç†å‘˜

### ä¼˜åŠ¿
1. âœ… **å®‰å…¨å¯é **ï¼šè¶…çº§ç®¡ç†å‘˜ç¡¬ç¼–ç åœ¨ä»£ç ä¸­ï¼Œæ— æ³•è¢«åˆ é™¤
2. âœ… **çµæ´»ç®¡ç†**ï¼šå¯ä»¥é€šè¿‡äº‘å‡½æ•°åŠ¨æ€æ·»åŠ /åˆ é™¤å…¶ä»–ç®¡ç†å‘˜
3. âœ… **ä¿æŒèº«ä»½**ï¼šæ·»åŠ ç®¡ç†å‘˜æƒé™ä¸ä¼šæ”¹å˜ç”¨æˆ·åŸæœ‰çš„èº«ä»½æ ‡ç­¾
4. âœ… **ç»Ÿä¸€æ£€æŸ¥**ï¼šæ‰€æœ‰æƒé™æ£€æŸ¥ä½¿ç”¨ç»Ÿä¸€çš„æ¨¡å—

## ğŸ” è¶…çº§ç®¡ç†å‘˜åˆ—è¡¨

```javascript
const SUPER_ADMIN_OPENIDS = [
  'oOJhu3QmRKlk8Iuu87G6ol0IrDyQ',  // ä¸»ç®¡ç†å‘˜
  'oOJhu3T9Us9TAnibhfctmyRw2Urc'   // å‰¯ç®¡ç†å‘˜
];
```

## ğŸ“ æ–‡ä»¶ç»“æ„

### 1. ç»Ÿä¸€æƒé™æ£€æŸ¥æ¨¡å—
**æ–‡ä»¶**: `cloudfunctions/common/adminCheck.js`

æä¾›ä¸¤ä¸ªæ ¸å¿ƒå‡½æ•°ï¼š
- `isAdmin(openid)` - æ£€æŸ¥æ˜¯å¦æ˜¯ç®¡ç†å‘˜
- `hasPermission(openid, permission)` - æ£€æŸ¥æ˜¯å¦æœ‰ç‰¹å®šæƒé™

### 2. è®¾ç½®ç®¡ç†å‘˜äº‘å‡½æ•°
**æ–‡ä»¶**: `cloudfunctions/setAdmin/index.js`

åŠŸèƒ½ï¼šç»™ç”¨æˆ·æ·»åŠ ç®¡ç†å‘˜æƒé™ï¼ˆä¿æŒåŸæœ‰èº«ä»½ä¸å˜ï¼‰

è°ƒç”¨æ–¹å¼ï¼š
```javascript
wx.cloud.callFunction({
  name: 'setAdmin',
  data: {
    targetOpenid: 'oOJhu3T9Us9TAnibhfctmyRw2Urc'
  }
})
```

### 3. å·²æ›´æ–°çš„äº‘å‡½æ•°
ä»¥ä¸‹äº‘å‡½æ•°å·²æ›´æ–°ä¸ºä½¿ç”¨æ··åˆæƒé™æ£€æŸ¥ï¼š

- âœ… `getCertificationApplications` - è·å–è®¤è¯ç”³è¯·åˆ—è¡¨
- âœ… `reviewCertification` - å®¡æ ¸è®¤è¯ç”³è¯·
- âœ… `getCertificationStats` - è·å–è®¤è¯ç»Ÿè®¡
- âœ… `getCommunityWorkerCertApplications` - è·å–ç¤¾åŒºå·¥ä½œè€…è®¤è¯ç”³è¯·
- âœ… `reviewCommunityWorkerCertification` - å®¡æ ¸ç¤¾åŒºå·¥ä½œè€…è®¤è¯

### 4. å‰ç«¯é¡µé¢
**æ–‡ä»¶**: `pages/mine/index.js`

å·²æ›´æ–° `checkIsAdmin` å‡½æ•°ï¼Œä½¿ç”¨æ··åˆæ£€æŸ¥æ–¹å¼ã€‚

## ğŸš€ ä½¿ç”¨æ­¥éª¤

### æ­¥éª¤1ï¼šä¸Šä¼ äº‘å‡½æ•°

éœ€è¦ä¸Šä¼ ä»¥ä¸‹äº‘å‡½æ•°ï¼ˆå³é”® â†’ ä¸Šä¼ å¹¶éƒ¨ç½²ï¼šäº‘ç«¯å®‰è£…ä¾èµ–ï¼‰ï¼š

1. `cloudfunctions/setAdmin`
2. `cloudfunctions/getCertificationApplications`
3. `cloudfunctions/reviewCertification`
4. `cloudfunctions/getCertificationStats`
5. `cloudfunctions/getCommunityWorkerCertApplications`
6. `cloudfunctions/reviewCommunityWorkerCertification`

### æ­¥éª¤2ï¼šè®¾ç½®ç®¡ç†å‘˜

åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·çš„**æ§åˆ¶å°**ä¸­è¿è¡Œï¼š

```javascript
wx.cloud.callFunction({
  name: 'setAdmin',
  data: {
    targetOpenid: 'oOJhu3T9Us9TAnibhfctmyRw2Urc'
  }
}).then(res => {
  console.log('è®¾ç½®ç®¡ç†å‘˜æˆåŠŸ:', res);
}).catch(err => {
  console.error('è®¾ç½®ç®¡ç†å‘˜å¤±è´¥:', err);
});
```

### æ­¥éª¤3ï¼šéªŒè¯æƒé™

1. ç¼–è¯‘å°ç¨‹åº
2. è¿›å…¥"æˆ‘çš„"é¡µé¢
3. åº”è¯¥èƒ½çœ‹åˆ°"ğŸ” è®¤è¯å®¡æ ¸"æŒ‰é’®ï¼ˆç®¡ç†å‘˜ä¸“å±ï¼‰

## ğŸ¯ ç®¡ç†å‘˜æƒé™åˆ—è¡¨

è®¾ç½®ä¸ºç®¡ç†å‘˜åï¼Œç”¨æˆ·å°†æ‹¥æœ‰ä»¥ä¸‹æƒé™ï¼š

```javascript
{
  canVerifyIssue: true,           // éªŒè¯é—®é¢˜
  canCreateProject: true,         // åˆ›å»ºé¡¹ç›®
  canPublishPolicy: true,         // å‘å¸ƒæ”¿ç­–
  canProvideConsultation: true,   // æä¾›å’¨è¯¢
  canDesignSolution: true,        // è®¾è®¡æ–¹æ¡ˆ
  canUpdateProgress: true,        // æ›´æ–°è¿›åº¦
  canViewUserContact: true,       // æŸ¥çœ‹ç”¨æˆ·è”ç³»æ–¹å¼
  canManageUsers: true,           // ç®¡ç†ç”¨æˆ·
  canReviewCertification: true,   // å®¡æ ¸è®¤è¯
  canDeleteContent: true,         // åˆ é™¤å†…å®¹
  canManageSystem: true           // ç³»ç»Ÿç®¡ç†
}
```

## ğŸ’¡ é‡è¦è¯´æ˜

1. **è¶…çº§ç®¡ç†å‘˜**ï¼šç¡¬ç¼–ç åœ¨ä»£ç ä¸­ï¼Œæ‹¥æœ‰æœ€é«˜æƒé™ï¼Œæ— æ³•è¢«åˆ é™¤
2. **åŠ¨æ€ç®¡ç†å‘˜**ï¼šé€šè¿‡ `setAdmin` äº‘å‡½æ•°æ·»åŠ ï¼Œå­˜å‚¨åœ¨æ•°æ®åº“ä¸­
3. **èº«ä»½ä¿æŒ**ï¼šæ·»åŠ ç®¡ç†å‘˜æƒé™ä¸ä¼šæ”¹å˜ç”¨æˆ·çš„èº«ä»½æ ‡ç­¾ï¼ˆå¦‚æ–½å·¥æ–¹ã€è®¾è®¡è€…ç­‰ï¼‰
4. **æ•°æ®åº“å­—æ®µ**ï¼š
   - `isAdmin: true` - ç®¡ç†å‘˜æ ‡è¯†
   - `permissions` - æƒé™å¯¹è±¡

## ğŸ”„ æƒé™æ£€æŸ¥æµç¨‹

```
ç”¨æˆ·è¯·æ±‚
  â†“
æ£€æŸ¥æ˜¯å¦æ˜¯è¶…çº§ç®¡ç†å‘˜ï¼ˆç¡¬ç¼–ç ï¼‰
  â†“ å¦
æŸ¥è¯¢æ•°æ®åº“ users é›†åˆ
  â†“
æ£€æŸ¥ isAdmin æˆ– permissions.canManageUsers
  â†“
è¿”å›æƒé™ç»“æœ
```

## ğŸ“ æ•°æ®åº“ç»“æ„

åœ¨ `users` é›†åˆä¸­ï¼Œç®¡ç†å‘˜ç”¨æˆ·ä¼šæœ‰ä»¥ä¸‹é¢å¤–å­—æ®µï¼š

```javascript
{
  _openid: "oOJhu3T9Us9TAnibhfctmyRw2Urc",
  userType: "contractor",  // ä¿æŒåŸæœ‰èº«ä»½
  badge: { ... },          // ä¿æŒåŸæœ‰å¾½ç« 
  isAdmin: true,           // ç®¡ç†å‘˜æ ‡è¯†
  permissions: {           // ç®¡ç†å‘˜æƒé™
    canManageUsers: true,
    canReviewCertification: true,
    // ... å…¶ä»–æƒé™
  }
}
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. ä¸Šä¼ äº‘å‡½æ•°æ—¶ï¼Œç¡®ä¿ `common` æ–‡ä»¶å¤¹ä¹Ÿè¢«ä¸Šä¼ 
2. å¦‚æœäº‘å‡½æ•°æŠ¥é”™æ‰¾ä¸åˆ° `adminCheck.js`ï¼Œéœ€è¦æ‰‹åŠ¨åˆ›å»º `common` æ–‡ä»¶å¤¹å¹¶ä¸Šä¼ 
3. è¶…çº§ç®¡ç†å‘˜çš„ openid ä¿®æ”¹éœ€è¦é‡æ–°ä¸Šä¼ æ‰€æœ‰ç›¸å…³äº‘å‡½æ•°
4. å»ºè®®å®šæœŸå¤‡ä»½ç®¡ç†å‘˜åˆ—è¡¨

## ğŸ‰ å®Œæˆ

ç°åœ¨ä½ çš„å°ç¨‹åºå·²ç»æ‹¥æœ‰å®Œå–„çš„ç®¡ç†å‘˜æƒé™ç³»ç»Ÿï¼

