# æ”¿åºœèº«ä»½å¾½ç« åŒæ­¥é—®é¢˜ä¿®å¤

## é—®é¢˜æè¿°
å½“ç®¡ç†å‘˜ç§»é™¤ç”¨æˆ·çš„æ”¿åºœèº«ä»½æ—¶ï¼Œç”¨æˆ·çš„ `userType` è¢«æ”¹å› `normal`ï¼Œä½†æ˜¯ `badge` å­—æ®µæ²¡æœ‰åŒæ­¥æ›´æ–°ï¼Œå¯¼è‡´ç”¨æˆ·ä»ç„¶æ˜¾ç¤ºæ”¿åºœå¾½ç« ã€‚

## é—®é¢˜åŸå› 
`removeGovCertification` äº‘å‡½æ•°åªæ›´æ–°äº† `userType` å­—æ®µï¼Œæ²¡æœ‰åŒæ­¥æ›´æ–° `badge` å’Œ `userTypeLabel` å­—æ®µã€‚

## ä¿®å¤æ–¹æ¡ˆ

### 1. âœ… ä¿®å¤ `removeGovCertification` äº‘å‡½æ•°

**ä¿®æ”¹æ–‡ä»¶**: `cloudfunctions/removeGovCertification/index.js`

**ä¿®æ”¹å†…å®¹**:
```javascript
// ğŸ†• æ™®é€šç”¨æˆ·çš„å¾½ç« é…ç½®
const normalBadge = {
  color: '#6B7280',
  icon: 'ğŸ‘¤',
  text: 'ç”¨æˆ·'
};

// æ›´æ–°ç”¨æˆ·æ•°æ®
await db.collection('users')
  .where({ _openid: userOpenid })
  .update({
    data: {
      userType: 'normal',
      badge: normalBadge,           // ğŸ”§ åŒæ­¥æ›´æ–°å¾½ç« 
      userTypeLabel: 'ç”¨æˆ·',         // ğŸ”§ æ›´æ–°ç±»å‹æ ‡ç­¾
      'profile.certificationStatus': 'removed',
      certificationRemovedTime: Date.now(),
      certificationRemovedBy: adminOpenid
    }
  });
```

### 2. âœ… ç¡®è®¤ `reviewGovCertification` äº‘å‡½æ•°

**æ–‡ä»¶**: `cloudfunctions/reviewGovCertification/index.js`

**å·²æœ‰ä»£ç **ï¼ˆæ— éœ€ä¿®æ”¹ï¼‰:
```javascript
// æ”¿åºœç”¨æˆ·å¾½ç« é…ç½®
const govBadge = {
  color: '#EF4444',
  icon: 'ğŸ”´',
  text: 'æ”¿åºœ'
};

// å®¡æ ¸é€šè¿‡æ—¶æ›´æ–°
const updateData = {
  userType: 'government',
  badge: govBadge,  // âœ… å·²ç»æœ‰åŒæ­¥æ›´æ–°å¾½ç« 
  'profile.department': application.data.department,
  'profile.position': application.data.position,
  'profile.workId': application.data.workId,
  'profile.certificationStatus': 'approved',
  certificationTime: Date.now()
};
```

## å¾½ç« é…ç½®å¯¹ç…§è¡¨

| ç”¨æˆ·ç±»å‹ | userType | badge.color | badge.icon | badge.text |
|---------|----------|-------------|------------|------------|
| æ™®é€šç”¨æˆ· | normal | #6B7280 | ğŸ‘¤ | ç”¨æˆ· |
| è®¾è®¡è€… | designer | #10B981 | ğŸŸ¢ | è®¾è®¡è€… |
| æ–½å·¥æ–¹ | contractor | #3B82F6 | ğŸ”µ | æ–½å·¥æ–¹ |
| æ”¿åºœ | government | #EF4444 | ğŸ”´ | æ”¿åºœ |

## éƒ¨ç½²æ­¥éª¤

1. **ä¸Šä¼ äº‘å‡½æ•°**:
   - åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­
   - å³é”®ç‚¹å‡» `cloudfunctions/removeGovCertification` æ–‡ä»¶å¤¹
   - é€‰æ‹©"ä¸Šä¼ å¹¶éƒ¨ç½²ï¼šäº‘ç«¯å®‰è£…ä¾èµ–"

2. **æµ‹è¯•æµç¨‹**:
   - ç®¡ç†å‘˜å®¡æ ¸é€šè¿‡æ”¿åºœè®¤è¯ â†’ ç”¨æˆ·è·å¾—æ”¿åºœå¾½ç«  âœ…
   - ç®¡ç†å‘˜ç§»é™¤æ”¿åºœèº«ä»½ â†’ ç”¨æˆ·å¾½ç« å˜å›æ™®é€šç”¨æˆ· âœ…

## ç›¸å…³äº‘å‡½æ•°

### èº«ä»½ç®¡ç†ç›¸å…³
- `reviewGovCertification` - å®¡æ ¸æ”¿åºœè®¤è¯ç”³è¯·ï¼ˆé€šè¿‡æ—¶è®¾ç½®æ”¿åºœå¾½ç« ï¼‰
- `removeGovCertification` - ç§»é™¤æ”¿åºœèº«ä»½ï¼ˆæ¢å¤æ™®é€šç”¨æˆ·å¾½ç« ï¼‰
- `updateUserInfo` - æ›´æ–°ç”¨æˆ·ä¿¡æ¯ï¼ˆè‡ªåŠ¨åŒæ­¥å¾½ç« ï¼‰

### å¾½ç« æ˜¾ç¤ºä½ç½®
- `pages/mine/index` - "æˆ‘çš„"é¡µé¢æ˜¾ç¤ºå¾½ç« 
- `pages/user-profile/index` - ç”¨æˆ·èµ„æ–™é¡µæ˜¾ç¤ºå¾½ç« 
- `pages/post-detail/index` - å¸–å­è¯¦æƒ…é¡µæ˜¾ç¤ºä½œè€…å¾½ç« 
- `pages/community/community` - ç¤¾åŒºåˆ—è¡¨æ˜¾ç¤ºä½œè€…å¾½ç« 

## é¢„æœŸæ•ˆæœ

### åœºæ™¯1ï¼šå®¡æ ¸é€šè¿‡
1. ç”¨æˆ·æäº¤æ”¿åºœè®¤è¯ç”³è¯·
2. ç®¡ç†å‘˜å®¡æ ¸é€šè¿‡
3. âœ… ç”¨æˆ· `userType` å˜ä¸º `government`
4. âœ… ç”¨æˆ· `badge` å˜ä¸ºæ”¿åºœå¾½ç« ï¼ˆçº¢è‰²ğŸ”´ï¼‰
5. âœ… ç”¨æˆ·ç•Œé¢æ˜¾ç¤ºæ”¿åºœå¾½ç« 

### åœºæ™¯2ï¼šç§»é™¤èº«ä»½
1. ç®¡ç†å‘˜ç§»é™¤ç”¨æˆ·çš„æ”¿åºœèº«ä»½
2. âœ… ç”¨æˆ· `userType` å˜ä¸º `normal`
3. âœ… ç”¨æˆ· `badge` å˜ä¸ºæ™®é€šç”¨æˆ·å¾½ç« ï¼ˆç°è‰²ğŸ‘¤ï¼‰
4. âœ… ç”¨æˆ·ç•Œé¢æ˜¾ç¤ºæ™®é€šç”¨æˆ·å¾½ç« 
5. âœ… ç”¨æˆ·å¤±å»æ”¿åºœæƒé™ï¼ˆæ— æ³•æŸ¥çœ‹ç”¨æˆ·è”ç³»æ–¹å¼ï¼‰

## æ³¨æ„äº‹é¡¹

1. **æ•°æ®ä¸€è‡´æ€§**: `userType` å’Œ `badge` å¿…é¡»åŒæ­¥æ›´æ–°
2. **æƒé™éªŒè¯**: ç§»é™¤èº«ä»½åï¼Œç”¨æˆ·åº”è¯¥å¤±å»æ”¿åºœæƒé™
3. **ç•Œé¢åˆ·æ–°**: ç”¨æˆ·éœ€è¦é‡æ–°è¿›å…¥é¡µé¢æ‰èƒ½çœ‹åˆ°å¾½ç« å˜åŒ–
4. **ç¼“å­˜æ¸…ç†**: å»ºè®®æ¸…é™¤æœ¬åœ°ç¼“å­˜åé‡æ–°ç™»å½•

## æµ‹è¯•æ¸…å•

- [ ] ä¸Šä¼  `removeGovCertification` äº‘å‡½æ•°
- [ ] ç®¡ç†å‘˜å®¡æ ¸é€šè¿‡æ”¿åºœè®¤è¯
- [ ] éªŒè¯ç”¨æˆ·è·å¾—æ”¿åºœå¾½ç« 
- [ ] ç®¡ç†å‘˜ç§»é™¤æ”¿åºœèº«ä»½
- [ ] éªŒè¯ç”¨æˆ·å¾½ç« å˜å›æ™®é€šç”¨æˆ·
- [ ] éªŒè¯ç”¨æˆ·å¤±å»æ”¿åºœæƒé™
- [ ] æµ‹è¯•ç”¨æˆ·é‡æ–°ç™»å½•åå¾½ç« æ­£ç¡®æ˜¾ç¤º

