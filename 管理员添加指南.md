# 管理员添加指南

## 📋 管理员权限说明

管理员拥有以下权限：
- ✅ 删除任何帖子
- ✅ 删除任何评论
- ✅ 审核认证申请（设计师、施工方、社区工作者）
- ✅ 查看所有认证申请统计

---

## 🔧 如何添加新管理员

### 第一步：获取新管理员的 openid

1. 让新管理员登录小程序
2. 在任意页面的控制台查看 openid
3. 或者使用测试脚本获取（见下方）

**测试脚本示例：**
```javascript
// 在小程序控制台运行
const app = getApp();
console.log('当前用户 openid:', app.globalData.openid || wx.getStorageSync('openid'));
```

---

### 第二步：修改代码文件

需要修改以下 **7 个文件**，在每个文件的管理员列表中添加新的 openid：

#### 1. `pages/post-detail/index.js` （帖子详情页）

**位置 1：** `loadPostDetail()` 函数中（约第 127-132 行）
```javascript
// 检查是否是管理员
const adminOpenids = [
  'oOJhu3QmRKlk8Iuu87G6ol0IrDyQ',  // 第一位管理员
  'oOJhu3T9Us9TAnibhfctmyRw2Urc',  // 第二位管理员
  '新管理员的openid'                // 第三位管理员 ← 在这里添加
];
```

**位置 2：** `checkProfessionalPermissions()` 函数中（约第 77-82 行）
```javascript
// 检查是否是管理员
const adminOpenids = [
  'oOJhu3QmRKlk8Iuu87G6ol0IrDyQ',  // 第一位管理员
  'oOJhu3T9Us9TAnibhfctmyRw2Urc',  // 第二位管理员
  '新管理员的openid'                // 第三位管理员 ← 在这里添加
];
```

**位置 3：** `loadComments()` 函数中（约第 461-466 行）
```javascript
// 检查是否是管理员
const adminOpenids = [
  'oOJhu3QmRKlk8Iuu87G6ol0IrDyQ',  // 第一位管理员
  'oOJhu3T9Us9TAnibhfctmyRw2Urc',  // 第二位管理员
  '新管理员的openid'                // 第三位管理员 ← 在这里添加
];
```

---

#### 2. `cloudfunctions/deletePost/index.js` （删除帖子云函数）

**位置：** `exports.main` 函数中（约第 17-22 行）
```javascript
// 检查是否是管理员
const adminOpenids = [
  'oOJhu3QmRKlk8Iuu87G6ol0IrDyQ',  // 第一位管理员
  'oOJhu3T9Us9TAnibhfctmyRw2Urc',  // 第二位管理员
  '新管理员的openid'                // 第三位管理员 ← 在这里添加
];
```

---

#### 3. `cloudfunctions/deleteComment/index.js` （删除评论云函数）

**位置：** `exports.main` 函数中（约第 17-22 行）
```javascript
// 检查是否是管理员
const adminOpenids = [
  'oOJhu3QmRKlk8Iuu87G6ol0IrDyQ',  // 第一位管理员
  'oOJhu3T9Us9TAnibhfctmyRw2Urc',  // 第二位管理员
  '新管理员的openid'                // 第三位管理员 ← 在这里添加
];
```

---

#### 4. `cloudfunctions/reviewCertification/index.js` （审核认证云函数）

**位置：** `exports.main` 函数开头（约第 11-16 行）
```javascript
// 管理员 openid 列表
const adminOpenids = [
  'oOJhu3QmRKlk8Iuu87G6ol0IrDyQ',  // 第一位管理员
  'oOJhu3T9Us9TAnibhfctmyRw2Urc',  // 第二位管理员
  '新管理员的openid'                // 第三位管理员 ← 在这里添加
];
```

---

#### 5. `cloudfunctions/getCertificationApplications/index.js` （获取认证申请列表云函数）

**位置：** `exports.main` 函数开头（约第 11-16 行）
```javascript
// 管理员 openid 列表
const adminOpenids = [
  'oOJhu3QmRKlk8Iuu87G6ol0IrDyQ',  // 第一位管理员
  'oOJhu3T9Us9TAnibhfctmyRw2Urc',  // 第二位管理员
  '新管理员的openid'                // 第三位管理员 ← 在这里添加
];
```

---

#### 6. `cloudfunctions/reviewCommunityWorkerCertification/index.js` （审核社区工作者认证云函数）

**位置：** `exports.main` 函数开头（约第 11-16 行）
```javascript
// 管理员 openid 列表
const adminOpenids = [
  'oOJhu3QmRKlk8Iuu87G6ol0IrDyQ',  // 第一位管理员
  'oOJhu3T9Us9TAnibhfctmyRw2Urc',  // 第二位管理员
  '新管理员的openid'                // 第三位管理员 ← 在这里添加
];
```

---

#### 7. `cloudfunctions/getCommunityWorkerCertApplications/index.js` （获取社区工作者认证申请列表云函数）

**位置：** `exports.main` 函数开头（约第 11-16 行）
```javascript
// 管理员 openid 列表
const adminOpenids = [
  'oOJhu3QmRKlk8Iuu87G6ol0IrDyQ',  // 第一位管理员
  'oOJhu3T9Us9TAnibhfctmyRw2Urc',  // 第二位管理员
  '新管理员的openid'                // 第三位管理员 ← 在这里添加
];
```

---

### 第三步：上传云函数

修改完代码后，需要上传以下 **6 个云函数**：

1. ✅ `cloudfunctions/deletePost` - 删除帖子
2. ✅ `cloudfunctions/deleteComment` - 删除评论
3. ✅ `cloudfunctions/reviewCertification` - 审核认证
4. ✅ `cloudfunctions/getCertificationApplications` - 获取认证申请列表
5. ✅ `cloudfunctions/reviewCommunityWorkerCertification` - 审核社区工作者认证
6. ✅ `cloudfunctions/getCommunityWorkerCertApplications` - 获取社区工作者认证申请列表

**上传方法：**
- 右键云函数文件夹 → 上传并部署：云端安装依赖

---

### 第四步：重新编译小程序

1. 点击微信开发者工具的"编译"按钮
2. 测试新管理员是否能看到删除按钮和审核功能

---

## 🧪 测试管理员权限

### 测试删除功能
1. 用新管理员账号登录
2. 打开任意帖子详情页
3. 查看控制台，应该显示：
   ```
   🔍 当前用户 openid: 新管理员的openid
   🔍 是否是管理员: true
   🔍 是否可以删除: true
   ```
4. 应该能看到"删除"按钮（即使不是帖子作者）

### 测试审核功能
1. 进入"我的" → "认证审核"
2. 应该能看到所有待审核的认证申请
3. 可以批准或拒绝申请

---

## 📝 快速添加模板

当您需要添加新管理员时，请提供以下信息：

```
新管理员 openid: [在这里填写]
新管理员备注: [例如：第三位管理员、张三]
```

然后我会帮您：
1. 修改所有 7 个文件
2. 告诉您需要上传哪 6 个云函数
3. 提供测试步骤

---

## 🔒 安全提示

1. **openid 是敏感信息**，请妥善保管
2. **不要将管理员 openid 提交到公开的代码仓库**
3. 建议将管理员列表存储在云数据库中，而不是硬编码
4. 定期审查管理员列表，移除不再需要的管理员

---

## 📞 联系方式

如有问题，请联系技术支持。

---

**文档版本：** v1.0  
**最后更新：** 2025-02-05  
**当前管理员列表：**
- 第一位管理员：`oOJhu3QmRKlk8Iuu87G6ol0IrDyQ`
- 第二位管理员：`oOJhu3T9Us9TAnibhfctmyRw2Urc`




