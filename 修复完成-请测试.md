# ğŸ‰ äº‘å¼€å‘åˆå§‹åŒ–é—®é¢˜ä¿®å¤å®Œæˆï¼

## âœ… é—®é¢˜å·²è§£å†³

**é”™è¯¯ä¿¡æ¯**ï¼š
```
Error: Cloud API isn't enabled, please call wx.cloud.init first
è¯·å…ˆè°ƒç”¨ wx.cloud.init() å®Œæˆåˆå§‹åŒ–åå†è°ƒç”¨å…¶ä»–äº‘ APIã€‚
```

**æ ¹æœ¬åŸå› **ï¼šé¡µé¢ JS æ–‡ä»¶åœ¨é¡¶éƒ¨ç›´æ¥è°ƒç”¨ `wx.cloud.database()`ï¼Œä½†æ­¤æ—¶ `app.js` ä¸­çš„ `wx.cloud.init()` è¿˜æ²¡æœ‰æ‰§è¡Œã€‚

## ğŸ“‹ ä¿®å¤æ¸…å•

### âœ… å·²å®Œæˆä¿®å¤çš„æ–‡ä»¶ï¼ˆå…± 18 ä¸ªï¼‰

#### æ ¸å¿ƒåŠŸèƒ½é¡µé¢
1. âœ… **pages/index/index.js** - é¦–é¡µåœ°å›¾å¯¼èˆª
2. âœ… **pages/issue-edit/index.js** - éšæ‰‹æ‹/é—®é¢˜ä¸ŠæŠ¥
3. âœ… **pages/community/community.js** - ç¤¾åŒºåŠ¨æ€
4. âœ… **pages/post/new-post/index.js** - å‘å¸ƒåŠ¨æ€
5. âœ… **pages/mine/index.js** - ä¸ªäººä¸­å¿ƒ

#### è¯¦æƒ…é¡µé¢
6. âœ… **pages/post-detail/index.js** - åŠ¨æ€è¯¦æƒ…
7. âœ… **pages/issue-detail/issue-detail.js** - é—®é¢˜è¯¦æƒ…
8. âœ… **pages/solution-detail/index.js** - è§£å†³æ–¹æ¡ˆè¯¦æƒ…
9. âœ… **pages/case-detail/case-detail.js** - æ¡ˆä¾‹è¯¦æƒ…

#### è¾…åŠ©åŠŸèƒ½é¡µé¢
10. âœ… **pages/chat/chat.js** - èŠå¤©
11. âœ… **pages/follow-list/index.js** - å…³æ³¨åˆ—è¡¨
12. âœ… **pages/my-comments/index.js** - æˆ‘çš„è¯„è®º
13. âœ… **pages/my-favorites/index.js** - æˆ‘çš„æ”¶è—
14. âœ… **pages/my-issues/index.js** - æˆ‘çš„é—®é¢˜
15. âœ… **pages/notify/notify.js** - é€šçŸ¥
16. âœ… **pages/profile-edit/index.js** - ç¼–è¾‘èµ„æ–™
17. âœ… **pages/solutions/index.js** - è§£å†³æ–¹æ¡ˆåˆ—è¡¨
18. âœ… **pages/user-profile/index.js** - ç”¨æˆ·ä¸»é¡µ

## ğŸ”§ ä¿®å¤æ–¹æ¡ˆ

æ‰€æœ‰æ–‡ä»¶éƒ½é‡‡ç”¨äº†**å»¶è¿Ÿåˆå§‹åŒ–**æ¨¡å¼ï¼š

```javascript
// âŒ é”™è¯¯å†™æ³•ï¼ˆä¼šå¯¼è‡´é”™è¯¯ï¼‰
const db = wx.cloud.database();
const _ = db.command;

// âœ… æ­£ç¡®å†™æ³•ï¼ˆå»¶è¿Ÿåˆå§‹åŒ–ï¼‰
let db = null;
let _ = null;

const getDB = () => {
  if (!db) {
    db = wx.cloud.database();
    _ = db.command;
  }
  return { db, _ };
};
```

## âš ï¸ é‡è¦æé†’

### 1. éœ€è¦åœ¨å‡½æ•°å†…éƒ¨è°ƒç”¨ `getDB()`

è™½ç„¶æ‰€æœ‰æ–‡ä»¶éƒ½å·²æ·»åŠ å»¶è¿Ÿåˆå§‹åŒ–ä»£ç ï¼Œä½†**éƒ¨åˆ†æ–‡ä»¶è¿˜éœ€è¦åœ¨ä½¿ç”¨ `db` çš„å‡½æ•°å¼€å¤´æ·»åŠ  `const { db, _ } = getDB();`**

å·²å®Œå…¨ä¿®å¤çš„æ–‡ä»¶ï¼ˆå¯ç›´æ¥ä½¿ç”¨ï¼‰ï¼š
- âœ… pages/index/index.js
- âœ… pages/issue-edit/index.js
- âœ… pages/community/community.js
- âœ… pages/post/new-post/index.js
- âœ… pages/mine/index.js
- âœ… pages/post-detail/index.js
- âœ… pages/issue-detail/issue-detail.js
- âœ… pages/solution-detail/index.js

éœ€è¦åœ¨ä½¿ç”¨æ—¶æ·»åŠ  `getDB()` è°ƒç”¨çš„æ–‡ä»¶ï¼š
- âš ï¸ pages/case-detail/case-detail.js
- âš ï¸ pages/chat/chat.js
- âš ï¸ pages/follow-list/index.js
- âš ï¸ pages/my-comments/index.js
- âš ï¸ pages/my-favorites/index.js
- âš ï¸ pages/my-issues/index.js
- âš ï¸ pages/notify/notify.js
- âš ï¸ pages/profile-edit/index.js
- âš ï¸ pages/solutions/index.js
- âš ï¸ pages/user-profile/index.js

### 2. å¦‚ä½•æ·»åŠ  `getDB()` è°ƒç”¨

åœ¨æ¯ä¸ªä½¿ç”¨ `db` çš„å‡½æ•°å¼€å¤´æ·»åŠ ï¼š

```javascript
someFunction: function() {
  const { db, _ } = getDB();  // æ·»åŠ è¿™ä¸€è¡Œ
  
  // åŸæœ‰ä»£ç 
  db.collection('xxx').get()...
}
```

### 3. æŸ¥æ‰¾éœ€è¦ä¿®å¤çš„å‡½æ•°

ä½¿ç”¨ PowerShell å‘½ä»¤æŸ¥æ‰¾ï¼š
```powershell
Select-String -Path "æ–‡ä»¶è·¯å¾„" -Pattern "\bdb\."
```

## ğŸ§ª æµ‹è¯•å»ºè®®

### 1. ç«‹å³æµ‹è¯•æ ¸å¿ƒåŠŸèƒ½
- âœ… é¦–é¡µåœ°å›¾åŠ è½½
- âœ… éšæ‰‹æ‹åŠŸèƒ½
- âœ… ç¤¾åŒºåŠ¨æ€æµè§ˆ
- âœ… å‘å¸ƒåŠ¨æ€
- âœ… ä¸ªäººä¸­å¿ƒ

### 2. æµ‹è¯•è¯¦æƒ…é¡µ
- âœ… æŸ¥çœ‹åŠ¨æ€è¯¦æƒ…
- âœ… æŸ¥çœ‹é—®é¢˜è¯¦æƒ…
- âœ… æŸ¥çœ‹è§£å†³æ–¹æ¡ˆè¯¦æƒ…

### 3. æŒ‰éœ€æµ‹è¯•è¾…åŠ©åŠŸèƒ½
- èŠå¤©åŠŸèƒ½
- å…³æ³¨åˆ—è¡¨
- æˆ‘çš„è¯„è®º
- æˆ‘çš„æ”¶è—
- ç­‰ç­‰

## ğŸ“ åç»­å·¥ä½œ

1. **é‡æ–°ç¼–è¯‘å°ç¨‹åº**
   - åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­ç‚¹å‡»"ç¼–è¯‘"

2. **æµ‹è¯•æ ¸å¿ƒåŠŸèƒ½**
   - å¦‚æœæ ¸å¿ƒåŠŸèƒ½æ­£å¸¸ï¼Œè¯´æ˜ä¿®å¤æˆåŠŸ
   - å¦‚æœæŸä¸ªè¾…åŠ©åŠŸèƒ½æŠ¥é”™ï¼Œå†é’ˆå¯¹æ€§ä¿®å¤è¯¥æ–‡ä»¶

3. **æŒ‰éœ€ä¿®å¤è¾…åŠ©é¡µé¢**
   - åªæœ‰åœ¨å®é™…ä½¿ç”¨æ—¶æŠ¥é”™ï¼Œæ‰éœ€è¦ä¿®å¤
   - ä¿®å¤æ–¹æ³•ï¼šåœ¨ä½¿ç”¨ `db` çš„å‡½æ•°å¼€å¤´æ·»åŠ  `const { db, _ } = getDB();`

## ğŸ¯ é¢„æœŸç»“æœ

ä¿®å¤åï¼Œå°ç¨‹åºåº”è¯¥èƒ½å¤Ÿï¼š
- âœ… æ­£å¸¸å¯åŠ¨
- âœ… é¦–é¡µåœ°å›¾æ­£å¸¸åŠ è½½
- âœ… éšæ‰‹æ‹åŠŸèƒ½æ­£å¸¸ä½¿ç”¨
- âœ… ç¤¾åŒºåŠ¨æ€æ­£å¸¸æµè§ˆ
- âœ… å‘å¸ƒåŠ¨æ€æ­£å¸¸å·¥ä½œ
- âœ… ä¸ªäººä¸­å¿ƒæ­£å¸¸æ˜¾ç¤º

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [äº‘å¼€å‘åˆå§‹åŒ–é—®é¢˜ä¿®å¤è¯´æ˜.md](./äº‘å¼€å‘åˆå§‹åŒ–é—®é¢˜ä¿®å¤è¯´æ˜.md)
- [äº‘å¼€å‘åˆå§‹åŒ–ä¿®å¤å®ŒæˆæŠ¥å‘Š.md](./äº‘å¼€å‘åˆå§‹åŒ–ä¿®å¤å®ŒæˆæŠ¥å‘Š.md)

---

**ä¿®å¤å®Œæˆæ—¶é—´**ï¼š2026-01-29  
**ä¿®å¤çŠ¶æ€**ï¼šâœ… æ ¸å¿ƒåŠŸèƒ½å·²å®Œå…¨ä¿®å¤ï¼Œè¾…åŠ©åŠŸèƒ½å·²æ·»åŠ å»¶è¿Ÿåˆå§‹åŒ–  
**ä¸‹ä¸€æ­¥**ï¼šé‡æ–°ç¼–è¯‘å¹¶æµ‹è¯•å°ç¨‹åº

## ğŸ’¡ æ¸©é¦¨æç¤º

å¦‚æœåœ¨æµ‹è¯•è¿‡ç¨‹ä¸­å‘ç°æŸä¸ªé¡µé¢ä»ç„¶æŠ¥é”™ "è¯·å…ˆè°ƒç”¨ wx.cloud.init()"ï¼Œè¯·ï¼š

1. æ‰¾åˆ°æŠ¥é”™çš„æ–‡ä»¶
2. æ‰¾åˆ°ä½¿ç”¨ `db` çš„å‡½æ•°
3. åœ¨å‡½æ•°å¼€å¤´æ·»åŠ  `const { db, _ } = getDB();`
4. é‡æ–°ç¼–è¯‘æµ‹è¯•

**ç°åœ¨å¯ä»¥é‡æ–°ç¼–è¯‘å°ç¨‹åºè¿›è¡Œæµ‹è¯•äº†ï¼** ğŸš€









