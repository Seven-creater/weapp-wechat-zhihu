# 错误修复说明

## 问题描述
在 `pages/post-detail/index.js` 中出现错误：
```
TypeError: l is not a function
at checkAndExecute (pages/post-detail/index.js:1133:5)
```

## 原因分析
`pages/post-detail/index.js` 文件第2行尝试导入 `checkAndExecute` 函数：
```javascript
const { hasPermission, checkAndExecute } = require("../../utils/permission.js");
```

但是 `utils/permission.js` 中没有导出这个函数。

## 解决方案
在 `utils/permission.js` 中添加了 `checkAndExecute` 函数：

```javascript
/**
 * 检查权限并执行操作
 * @param {string} permission - 权限名称
 * @param {function} callback - 有权限时执行的回调函数
 */
function checkAndExecute(permission, callback) {
  if (hasPermission(permission)) {
    callback();
  } else {
    wx.showToast({
      title: '您没有此操作权限',
      icon: 'none'
    });
  }
}
```

并在 `module.exports` 中导出：
```javascript
module.exports = {
  getUserType,
  getOpenid,
  hasPermission,
  checkAndExecute,  // ✅ 新增
  canAddDesignSolution,
  canCreateProject,
  canUpdateProgress,
  canConfirmCompletion,
  canViewContact,
  isCurrentUser,
  getStatusText,
  getStatusColor
};
```

## 测试步骤
1. 重新编译小程序
2. 打开帖子详情页
3. 确认页面正常加载，没有报错

## 相关文件
- `utils/permission.js` - 已修复
- `pages/post-detail/index.js` - 使用该函数

---

**修复时间**: 2026-02-01
**状态**: ✅ 已修复



